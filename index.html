<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Î•Î¹ÎºÎ¿Î½Î¯Î´Î¹Î± Î³Î¹Î± iOS/Android -->
<link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22%23e91e63%22>ğŸŒ¸</text></svg>">
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFRSURBVHgB7Za9SgNBFIVPd2Plo5U2gq0/IDaCjVjYibWCIJjO0t+QxsYH0AfwAazETkGwsfApfAGx0E6wsBDh2oSo6yST2Y3uslfYBWc+uDB7mbln5s7s7gAOh8Ph+M8QYAOANSwA8IyCQQDWsADAOxaEAgBvWBACADxjQSAA8IQFoQDAIxaEAgAPWBAGANxjQRAAMLAgDAC4w4IgAGCDC6IAgFssCAIAbrAgCgC4xoIoAOAaC6IAgCssiAIALrEgCgC4wIIoAOACC6IAgHMsCAIATrEgCAA4w4IgAOAUC4IAgBMsCAIATrAgCgA4xoIoAOAYC6IAgCMsCAIADrEgCgA4wIIoAOAAZ84CAGNv2E22n6JhAgFgvKX+BKBf3AYBrF/BCuuvYYUA2Jg8gI1pAJC16b+V1XkAe6oDLJ+sAiB7cwDqj37A4pJSAORvAEi9n+oA0nVAVqsCUvTfADaMAAzYsgIy+lFDRn8GGf0Y8vR7kKffgTz9HuTp9yBPvwcF6PcgT78DBen3oED9DhSs34Ei9DtQhH4HitTvQJH6HShSvwNF6vdQqH4Pher3UKh+D8b6HTS0fyZQ/1fUTP8NGut30Oz0/4o+0e+gWel3OJx+nf4ODdH/cqBO1QAAAABJRU5ErkJggg==">
<link rel="icon" type="image/png" sizes="16x16" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFQSURBVHgBtZQ9SgNBFIVnNlaihYWoWIn4A2Il2Ig2YmEhtgpCMJ2lvyGNjQ+gD+AFrEQ7BcHGwgp/QCy0EywsRLg2Ieo6ySR7Y3c3u8smd8+duzNzz9w7O5MBaIZrJgBPKBgE4A0LAjxjQSAA8IwFgQDAExYEAgAPWBAIADxgQSAAcI8FgQDAHRYEAgC3WBAIANxgQSAAcI0FgQDAPywoBwBm7kIe8ocOBs4p8hHnT6DYfCx3oYkZWC0XAGhTO8wOZteYdgGk+AG1g1g7L0R+ePilGMCWJ1A7iGX6kPIs1idT9AWWXIDaQUzyPVQc+e3bCz2DRXMKtYNp3cZ7LITI/yozcMgFqB3M+DZe40n69q0fALgpBqgdxGL1N74n0jH55fE3ZbQBqL1E7WAWezmzz5uU74P0Xb/3AajdRO1g4qM24zFOX7Z+AUADFR9+UwEwAAAAAElFTkSuQmCC">

<!-- Î§ÏÏÎ¼Î± Î¸Î­Î¼Î±Ï„Î¿Ï‚ Î³Î¹Î± Android -->
<meta name="theme-color" content="#e91e63">
<meta name="msapplication-TileColor" content="#e91e63">
<meta name="msapplication-navbutton-color" content="#e91e63">

<!-- Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· web app manifest Î³Î¹Î± PWA -->
<link rel="manifest" href="data:application/manifest+json,{
  \"name\": \"BudgetBuddy ÎˆÎ¾Î¿Î´Î± Î£Ï€Î¹Ï„Î¹Î¿Ï\",
  \"short_name\": \"BudgetBuddy\",
  \"description\": \"Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¿Î¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÏÎ½ ÎµÎ¾ÏŒÎ´Ï‰Î½\",
  \"start_url\": \".\",
  \"display\": \"standalone\",
  \"background_color\": \"#ffe6f1\",
  \"theme_color\": \"#e91e63\",
  \"icons\": [
    {
      \"src\": \"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90' fill='%23e91e63'>ğŸŒ¸</text></svg>\",
      \"sizes\": \"any\",
      \"type\": \"image/svg+xml\"
    }
  ]
}">

<!-- Apple specific meta tags -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BudgetBuddy">
<meta name="format-detection" content="telephone=no">
<meta name="mobile-web-app-capable" content="yes">
<title>BudgetBuddy â€” ÎˆÎ¾Î¿Î´Î± Î£Ï€Î¹Ï„Î¹Î¿Ï</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ¸</text></svg>">
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(to bottom, #ffe6f1, #fff0f7);
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }

  .stars {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 150px;
    overflow: hidden;
    z-index: 0;
  }

  .star {
    position: absolute;
    color: #fff;
    font-size: 18px;
    opacity: 0.8;
    animation: twinkle 5s infinite ease-in-out;
  }

  @keyframes twinkle {
    0%,100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.3); }
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 100px auto 40px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 25px 35px;
  }

  h1 {
    text-align: center;
    color: #e91e63;
    position: relative;
  }

  .sync-header {
    position: relative;
    display: inline-block;
    padding-right: 50px;
  }
  
  .sync-button-header {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    background: #e91e63;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 5px 15px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    box-shadow: 0 2px 5px rgba(233, 30, 99, 0.3);
    transition: all 0.3s;
  }
  
  .sync-button-header:hover {
    background: #d81b60;
    transform: translateY(-50%) scale(1.05);
  }
  
  .big-sync-button {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #e91e63;
    color: white;
    border: none;
    border-radius: 25px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    z-index: 1000;
    transition: all 0.3s;
  }
  
  .big-sync-button:hover {
    background: #d81b60;
    transform: scale(1.05);
    box-shadow: 0 6px 15px rgba(0,0,0,0.3);
  }
  
  .sync-status-dot {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-left: 10px;
    vertical-align: middle;
  }
  
  .sync-online { background: #4caf50; animation: pulse 2s infinite; }
  .sync-offline { background: #f44336; }
  .sync-connecting { background: #ff9800; animation: pulse 2s infinite; }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  .code-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 3000;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  
  .code-modal-content {
    background: white;
    border-radius: 15px;
    padding: 30px;
    max-width: 400px;
    width: 100%;
    text-align: center;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
  }
  
  .code-display {
    font-size: 42px;
    font-weight: bold;
    letter-spacing: 5px;
    color: #e91e63;
    background: #ffe6f1;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    font-family: monospace;
  }
  
  .sync-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 2000;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  
  .sync-modal-content {
    background: white;
    border-radius: 15px;
    padding: 30px;
    max-width: 400px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  
  .sync-modal h2 {
    color: #e91e63;
    margin-top: 0;
    text-align: center;
  }
  
  .sync-modal-section {
    margin: 20px 0;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 10px;
  }

  input, select, button {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 16px;
    width: 100%;
    margin-bottom: 8px;
    -webkit-appearance: none;
  }
  
  input:focus, select:focus {
    outline: none;
    border-color: #e91e63;
    box-shadow: 0 0 0 2px rgba(233, 30, 99, 0.1);
  }
  
  button {
    cursor: pointer;
    transition: all 0.2s;
  }
  
  button:active {
    transform: scale(0.95);
  }
  
  button.add { 
    background: #e91e63; 
    color: white; 
    border: none;
    font-weight: bold;
    padding: 14px;
    margin-top: 10px;
  }

  button {
    cursor: pointer;
  }

  button.add { background: #e91e63; color: white; border: none; }
  button.del { background: #f44336; color: white; border: none; }
  button.cat { background: #ff80ab; color: white; border: none; }
  button.recurring { background: #4caf50; color: white; border: none; margin-top: 10px; }
  button.edit { background: #2196f3; color: white; border: none; padding: 4px 8px; font-size: 12px; }
  button.bank { background: #9c27b0; color: white; border: none; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }

  th, td {
    padding: 8px;
    border-bottom: 1px solid #eee;
    text-align: left;
  }

  th {
    background: #ffe4ec;
  }

  .summary {
    margin-top: 20px;
    padding: 15px;
    background: #fff0f7;
    border-radius: 8px;
  }

  .summary strong {
    color: #e91e63;
  }

  .summary-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-top: 15px;
  }

  .summary-box {
    padding: 15px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  .final-summary {
    margin-top: 20px;
    padding: 20px;
    background: linear-gradient(to right, #e8f5e9, #f1f8e9);
    border-radius: 8px;
    border: 2px solid #4caf50;
  }

  .final-numbers {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 15px;
  }

  .final-number {
    text-align: center;
    padding: 15px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .final-number h4 {
    margin: 0 0 10px 0;
    color: #333;
  }

  .final-number-value {
    font-size: 24px;
    font-weight: bold;
    margin: 10px 0;
  }

  .catlist {
    margin-top: 10px;
    font-size: 14px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
  }

  .category-item {
    padding: 10px;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 4px solid #e91e63;
  }

  .category-item.over {
    border-left-color: #f44336;
  }

  .category-item.under {
    border-left-color: #4caf50;
  }

  .footer {
    text-align: center;
    margin-top: 20px;
    color: #888;
    font-size: 13px;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 8px;
  }

  .categories-manager {
    margin: 20px 0;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 8px;
  }

  .categories-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 10px 0;
  }

  .category-tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 5px 10px;
    background: #e91e63;
    color: white;
    border-radius: 20px;
    font-size: 14px;
  }

  .category-tag button {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    padding: 0;
    font-size: 12px;
  }

  .bank-section {
    margin: 20px 0;
    padding: 15px;
    background: #f0f8ff;
    border-radius: 8px;
  }

  .bank-accounts {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
  }

  .bank-account {
    padding: 15px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  .connected-users {
    margin: 15px 0;
    padding: 10px;
    background: #e8f5e9;
    border-radius: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  
  .user-badge {
    background: #4caf50;
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  
  .user-badge.you {
    background: #e91e63;
  }
  
  .user-badge.creator {
    background: #ff9800;
    position: relative;
  }

  /* Î£Ï„Ï…Î» Î³Î¹Î± Ï„Î± Î½Î­Î± modals */
  .custom-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 3000;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  
  .custom-modal-content {
    background: white;
    border-radius: 15px;
    padding: 0;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  
  .custom-modal-header {
    position: relative;
    background: #9c27b0;
    color: white;
    padding: 20px;
    border-radius: 15px 15px 0 0;
  }
  
  .custom-modal-header h2 {
    margin: 0;
    padding-right: 40px;
  }
  
  .modal-close-button {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  
  .modal-close-button:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
  }
  
  .custom-modal-body {
    padding: 20px;
  }
  
  .custom-modal-footer {
    padding: 15px 20px 20px;
    text-align: center;
    border-top: 1px solid #eee;
  }

  @media (max-width: 768px) {
    .container {
      margin: 80px 10px 20px;
      padding: 15px 20px;
    }
    
    h1 {
      font-size: 1.5em;
    }
    
    .form-section {
      padding-bottom: 80px;
    }
    
    .big-sync-button {
      top: 10px;
      right: 10px;
      padding: 8px 15px;
      font-size: 14px;
    }
    
    .sync-button-header {
      position: relative;
      margin-top: 10px;
      right: auto;
      top: auto;
      transform: none;
      display: block;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }
    
    .code-display {
      font-size: 32px;
      padding: 15px;
    }
    
    input, select, button {
      margin-bottom: 8px;
      width: 100%;
    }
    
    table {
      font-size: 0.9em;
    }
    
    .catlist {
      grid-template-columns: 1fr;
    }
    
    .summary-grid {
      grid-template-columns: 1fr;
    }
    
    .bank-accounts {
      grid-template-columns: 1fr;
    }
    
    .final-numbers {
      grid-template-columns: 1fr;
    }
    
    .final-summary {
      padding: 15px;
    }
    
    /* ÎÎ•Î‘ RULES Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— */
    body {
      font-size: 15px;
      line-height: 1.5;
    }
    
    p, li, td, th {
      font-size: 15px;
    }
} /* ÎšÎ›Î•Î™Î£Î• Î•Î”Î© Î¤ÎŸ MEDIA QUERY! */

/* Î Î¡ÎŸÎ£Î˜Î•Î£Î• Î‘Î¥Î¤Î‘ Î•ÎÎ© Î‘Î ÎŸ Î¤ÎŸ MEDIA QUERY */
/* Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· touch feedback */
button:active {
  opacity: 0.8;
  transform: scale(0.98);
}

/* Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·Ï‚ dropdowns ÏƒÎµ iOS */
select {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e91e63' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 16px;
  padding-right: 40px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>

<div class="stars" id="stars"></div>

<!-- ÎœÎ•Î“Î‘Î›ÎŸ ÎšÎŸÎ¥ÎœÎ Î™ Î£Î¥ÎÎ”Î•Î£Î—Î£ -->
<button class="big-sync-button" onclick="showSyncModal()" id="mainSyncButton">
  ğŸ”— Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ£
  <span class="sync-status-dot" id="mainSyncDot"></span>
</button>

<!-- MODAL Î“Î™Î‘ Î•ÎœÎ¦Î‘ÎÎ™Î£Î— ÎšÎ©Î”Î™ÎšÎŸÎ¥ -->
<div class="code-modal" id="codeModal">
  <div class="code-modal-content">
    <h2 style="color: #e91e63;">ğŸ‰ Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î—Î˜Î—ÎšÎ• ÎÎ•ÎŸÎ£ Î Î¡ÎŸÎ¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£!</h2>
    <p>ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ®Ï‚ ÏƒÎ±Ï‚ ÎµÎ¯Î½Î±Î¹:</p>
    
    <div class="code-display" id="generatedCode"></div>
    
    <p style="color: #666; margin: 15px 0;">
      <strong>ğŸ“ Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</strong> Î‘Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¿ Î¼Î¿Î½Î±Î´Î¹ÎºÏŒÏ‚ ÏƒÎ±Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!<br>
      Î”ÏÏƒÏ„Îµ Ï„Î¿Î½ ÏƒÏ„Î¿Î½ ÏƒÏÎ¶Ï…Î³Î¿/ÏƒÏÎ¶Ï…Î³Î¿ Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯.
    </p>
    
    <div style="display: flex; gap: 10px; margin: 20px 0;">
      <button onclick="showQRForCode()" style="flex: 1; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer;">
        ğŸ“± QR Code
      </button>
      <button onclick="copyGeneratedCode()" style="flex: 1; padding: 12px; background: #2196f3; color: white; border: none; border-radius: 8px; cursor: pointer;">
        ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®
      </button>
    </div>
    
    <button onclick="closeCodeModal()" style="width: 100%; padding: 12px; background: #e91e63; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">
      âœ… ÎšÎ±Ï„Î¬Î»Î±Î²Î±, ÎºÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿
    </button>
  </div>
</div>

<!-- ÎŸÎ›Î— Î— Î Î›Î—Î¡Î—Î£ Î•Î¦Î‘Î¡ÎœÎŸÎ“Î— -->
<div class="container">
  <h1>
    <div class="sync-header">
      ğŸŒ¸ BudgetBuddy â€” ÎˆÎ¾Î¿Î´Î± Î£Ï€Î¹Ï„Î¹Î¿Ï ğŸŒ¸
      <button class="sync-button-header" onclick="showSyncModal()">
        <span id="syncButtonText">Î£Ï…Î½Î´Î­ÏƒÎ¿Ï…</span>
        <span class="sync-status-dot" id="headerSyncDot"></span>
      </button>
    </div>
  </h1>
  
  <!-- ÎÎ•Î‘ ÎšÎŸÎ¥ÎœÎ Î™Î‘ Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘Î£ ÎÎ•ÎŸÎ¥ ÎœÎ—ÎÎ‘ -->
  <div style="display: flex; justify-content: center; gap: 10px; margin: 15px 0; flex-wrap: wrap;">
    <button onclick="showNewBudgetModal()" style="padding: 10px 20px; background: #9c27b0; color: white; border: none; border-radius: 25px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px;">
      ğŸ“… ÎÎ­Î¿Ï‚ ÎœÎ®Î½Î±Ï‚
    </button>
    <button onclick="saveArchivedBudget()" style="padding: 10px 20px; background: #ff9800; color: white; border: none; border-radius: 25px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px;">
      ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î‘ÏÏ‡ÎµÎ¯Î¿Ï…
    </button>
    <button onclick="showArchivedBudgets()" style="padding: 10px 20px; background: #607d8b; color: white; border: none; border-radius: 25px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px;">
      ğŸ“ Î ÏÎ¿Î²Î¿Î»Î® Î‘ÏÏ‡ÎµÎ¯Ï‰Î½
    </button>
  </div>
  
  <div class="connected-users" id="connectedUsers" style="display: none;">
    <strong>Î£Ï…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Î¹:</strong>
    <div id="usersList"></div>
  </div>

  <div>
    <label>ÎœÎ·Î½Î¹Î±Î¯Î¿ ÎµÎ¹ÏƒÏŒÎ´Î·Î¼Î± (â‚¬):</label>
    <input type="number" id="income" value="2000">
    &nbsp;&nbsp;
    <label>ÎœÎ®Î½Î±Ï‚:</label>
    <input type="month" id="month" value="">
  </div>

  <h3>â• ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· ÎµÎ¾ÏŒÎ´Î¿Ï…</h3>
  <div>
    <label>Î Î¿ÏƒÏŒ (â‚¬):</label>
    <input type="number" id="amount" step="0.01" style="width:100px;" placeholder="0.00">
    <label>ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±:</label>
    <select id="category"></select>
    <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±:</label>
    <input type="date" id="date" value="">
    <br><br>
    <label>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</label>
    <input type="text" id="note" placeholder="Ï€.Ï‡. ÏˆÏÎ½Î¹Î± ÏƒÎ¿ÏÏ€ÎµÏ Î¼Î¬ÏÎºÎµÏ„" style="width:250px;">
    <button class="add" onclick="addExpense()">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·</button>
  </div>

  <h3>ğŸ’° Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„ÏÎ±Ï€ÎµÎ¶Î¹ÎºÏÎ½ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½</h3>
  <div class="bank-section">
    <div class="bank-accounts">
      <div class="bank-account">
        <h4>Î‘Î»Ï†Î± Î¤ÏÎ¬Ï€ÎµÎ¶Î±</h4>
        <input type="number" id="alphaBank" step="0.01" placeholder="0.00" style="width:100%;">
      </div>
      <div class="bank-account">
        <h4>Î•Î¸Î½Î¹ÎºÎ® Î¤ÏÎ¬Ï€ÎµÎ¶Î±</h4>
        <input type="number" id="nationalBank" step="0.01" placeholder="0.00" style="width:100%;">
      </div>
      <div class="bank-account">
        <h4>ÎœÎµÏ„ÏÎ·Ï„Î¬</h4>
        <input type="number" id="cash" step="0.01" placeholder="0.00" style="width:100%;">
      </div>
      <div class="bank-account">
        <h4>Î˜Î± Ï€Î¬ÏÏ‰ Î±ÎºÏŒÎ¼Î±</h4>
        <input type="number" id="expectedIncome" step="0.01" placeholder="0.00" style="width:100%;">
      </div>
    </div>
    <button class="bank" onclick="saveBankBalances()" style="margin-top: 15px;">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½</button>
  </div>

  <h3>âš™ï¸ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÏÎ½</h3>
  <div class="categories-manager">
    <div>
      <input type="text" id="newCategoryName" placeholder="ÎŒÎ½Î¿Î¼Î± Î½Î­Î±Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚" style="width:200px;">
      <button class="cat" onclick="addNewCategory()">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚</button>
    </div>
    
    <div class="categories-list" id="categoriesList"></div>
    
    <p><small>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Î— Î´Î¹Î±Î³ÏÎ±Ï†Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚ Î¸Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ ÎºÎ±Î¹ Ï„Î± ÏƒÏ…Î½Î±Ï†Î® Î­Î¾Î¿Î´Î±!</small></p>
  </div>

  <h3>ğŸ’° Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î¼Î·Î½Î¹Î±Î¯Ï‰Î½ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½</h3>
  <div id="recurringSetup" style="padding: 15px; background: #f9f9f9; border-radius: 8px; margin-bottom: 20px;">
    <p><strong>ÎŸÏÎ¯ÏƒÏ„Îµ Ï„Î¿Î½ Î¼Î·Î½Î¹Î±Î¯Î¿ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ Î³Î¹Î± ÎºÎ¬Î¸Îµ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±:</strong></p>
    <div id="recurringInputs"></div>
    <button class="recurring" onclick="saveRecurringAmounts()">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½</button>
    <button class="recurring" onclick="generateRecurringExpenses()">ğŸ”„ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î•Ï€Î±Î½Î±Î»Î±Î¼Î²Î±Î½ÏŒÎ¼ÎµÎ½Ï‰Î½ Î•Î¾ÏŒÎ´Ï‰Î½</button>
  </div>

  <h3>ğŸ“‹ Î Î¯Î½Î±ÎºÎ±Ï‚ ÎµÎ¾ÏŒÎ´Ï‰Î½</h3>
  <table id="expensesTable">
    <thead>
      <tr>
        <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
        <th>ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</th>
        <th>Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·</th>
        <th>Î Î¿ÏƒÏŒ (â‚¬)</th>
        <th>Î”Î¹Î±Î³ÏÎ±Ï†Î®</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  
  <h3>ğŸ“ˆ Î£Î¤Î‘Î¤Î™Î£Î¤Î™ÎšÎ‘</h3>
  <div class="stats-section" style="margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 10px;">
    <div class="stats-grid" id="statsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;"></div>
    
    <div class="chart-container" style="margin-top: 20px; padding: 15px; background: white; border-radius: 10px;">
      <h4 style="margin-top: 0; color: #e91e63;">ğŸ“Š ÎšÎ±Ï„Î±Î½Î¿Î¼Î® Î•Î¾ÏŒÎ´Ï‰Î½</h4>
      <div id="expenseChart" style="height: 200px; display: flex; align-items: flex-end; gap: 5px; padding: 10px; border: 1px solid #eee; border-radius: 8px;"></div>
      <p style="text-align: center; color: #666; font-size: 13px; margin-top: 10px;">
        <span style="background: #e91e63; width: 10px; height: 10px; display: inline-block; border-radius: 2px; margin-right: 5px;"></span>
        ÎÏˆÎ¿Ï‚ Î¼Ï€Î¬ÏÎ±Ï‚ = Î Î¿ÏƒÏŒ Î­Î¾Î¿Î´Î¿Ï…
      </p>
    </div>
  </div>
  
  <h3>ğŸ“Š Î£ÏÎ½Î¿ÏˆÎ· Î±Î½Î¬ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</h3>
  <div class="catlist" id="catList"></div>

  <h3>ğŸ’° Î¤Î•Î›Î™ÎšÎ— Î£Î¥ÎÎŸÎ¨Î—</h3>
  <div class="final-summary">
    <h3 style="text-align: center; margin-top: 0; color: #2e7d32;">ğŸ“Š Î¤Î•Î›Î™ÎšÎ— Î•Î™ÎšÎŸÎÎ‘ Î§Î¡Î—ÎœÎ‘Î¤Î©Î</h3>
    
    <div class="final-numbers">
      <div class="final-number">
        <h4>Î•Î§ÎŸÎ¥Î ÎÎŸÎ”Î•Î¥Î¤Î•Î™</h4>
        <div class="final-number-value" id="totalSpent">0 â‚¬</div>
        <div style="color: #666; font-size: 14px;">Î£ÏÎ½Î¿Î»Î¿ Ï€Î»Î·ÏÏ‰Î¼Î­Î½Ï‰Î½ ÎµÎ¾ÏŒÎ´Ï‰Î½</div>
      </div>
      
      <div class="final-number">
        <h4>Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î•ÎÎŸÎ”Î©Î</h4>
        <div class="final-number-value" id="remainingExpenses">0 â‚¬</div>
        <div style="color: #666; font-size: 14px;">Î‘Ï€Î¿Î¼Î­Î½ÎµÎ¹ Î½Î± Ï€Î»Î·ÏÏ‰Î¸Î¿ÏÎ½</div>
      </div>
      
      <div class="final-number">
        <h4>Î£Î¥ÎÎŸÎ›ÎŸ Î•Î£ÎŸÎ”Î©Î</h4>
        <div class="final-number-value" id="totalIncome">0 â‚¬</div>
        <div style="color: #666; font-size: 14px;">ÎŒÎ»Î± Ï„Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï‡ÏÎ®Î¼Î±Ï„Î±</div>
      </div>
    </div>
    
    <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; text-align: center;">
      <h4 style="margin: 0 0 10px 0; color: #333;">Î¤Î•Î›Î™ÎšÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ</h4>
      <div style="font-size: 28px; font-weight: bold; color: #e91e63;" id="finalBalance">0 â‚¬</div>
      <div style="color: #666; font-size: 14px; margin-top: 5px;">
        (Î£ÏÎ½Î¿Î»Î¿ Î•ÏƒÏŒÎ´Ï‰Î½ - ÎˆÏ‡Î¿Ï…Î½ ÎÎ¿Î´ÎµÏ…Ï„ÎµÎ¯)
      </div>
    </div>
  </div>

  <div class="footer" id="footerText">
    Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬ (localStorage).
    <div id="syncInfo" style="margin-top: 5px;"></div>
  </div>
</div>

<!-- MODAL Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ¥ -->
<div class="sync-modal" id="syncModal">
  <div class="sync-modal-content">
    <h2>ğŸ”— Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ£ Î Î¡ÎŸÎ¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ¥</h2>
    
    <div id="syncModalContent"></div>
    
    <div style="text-align: center; margin-top: 20px;">
      <button onclick="closeSyncModal()" style="padding: 8px 20px; background: #f0f0f0; border: none; border-radius: 5px; cursor: pointer;">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
    </div>
  </div>
</div>

<!-- ÎÎ•ÎŸ CUSTOM MODAL (Î³Î¹Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Î¹ Î¬Î»Î»Î±) -->
<div class="custom-modal" id="customModal">
  <div class="custom-modal-content">
    <div class="custom-modal-header">
      <h2 id="customModalTitle">Î¤Î¯Ï„Î»Î¿Ï‚</h2>
      <button class="modal-close-button" onclick="closeCustomModal()">Ã—</button>
    </div>
    <div class="custom-modal-body" id="customModalBody">
      Î ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿
    </div>
    <div class="custom-modal-footer">
      <button onclick="closeCustomModal()" style="padding: 10px 25px; background: #e91e63; color: white; border: none; border-radius: 8px; cursor: pointer;">
        ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿
      </button>
    </div>
  </div>
</div>

<script>
// ==================== ÎŸÎ›Î•Î£ ÎŸÎ™ ÎœÎ•Î¤Î‘Î’Î›Î—Î¤Î•Î£ ====================
let categories = JSON.parse(localStorage.getItem('cats') || '[]');
let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
let recurringAmounts = JSON.parse(localStorage.getItem('recurringAmounts') || '{}');
let income = parseFloat(localStorage.getItem('income') || '2000');

let bankBalances = JSON.parse(localStorage.getItem('bankBalances') || JSON.stringify({
  alphaBank: 0,
  nationalBank: 0,
  cash: 0,
  expectedIncome: 0
}));

let syncData = JSON.parse(localStorage.getItem('budgetbuddy_sync') || '{}');
let currentUser = syncData.userName || "ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±";
let currentBudget = syncData.budgetCode || null;
let firebaseRef = null;

// ==================== Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ ====================
function showQuickMessage(message, type = 'info') {
  const msg = document.createElement('div');
  msg.style.cssText = `
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4caf50' : '#333'};
    color: white;
    padding: 12px 24px;
    border-radius: 25px;
    z-index: 10000;
    font-size: 14px;
    animation: fadeInOut 3s ease-in-out;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 10px;
  `;
  msg.innerHTML = `
    ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}
    <span>${message}</span>
  `;
  
  document.body.appendChild(msg);
  
  setTimeout(() => {
    msg.style.animation = 'fadeOut 0.5s ease-in-out';
    setTimeout(() => msg.remove(), 500);
  }, 3000);
  
  if (!document.getElementById('msg-styles')) {
    const style = document.createElement('style');
    style.id = 'msg-styles';
    style.textContent = `
      @keyframes fadeInOut {
        0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        10% { opacity: 1; transform: translateX(-50%) translateY(0); }
        90% { opacity: 1; transform: translateX(-50%) translateY(0); }
        100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
      }
      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  }
}

function updateSyncUI(status, data = null) {
  const mainDot = document.getElementById('mainSyncDot');
  const headerDot = document.getElementById('headerSyncDot');
  const buttonText = document.getElementById('syncButtonText');
  const syncInfo = document.getElementById('syncInfo');
  const connectedUsers = document.getElementById('connectedUsers');
  const usersList = document.getElementById('usersList');
  
  if (status === 'online' && data) {
    mainDot.className = 'sync-status-dot sync-online';
    headerDot.className = 'sync-status-dot sync-online';
    
    if (data.members && Array.isArray(data.members)) {
      connectedUsers.style.display = 'flex';
      
      const uniqueMembers = [...new Set(data.members)];
      
      usersList.innerHTML = uniqueMembers.map(member => {
        const isYou = (member === currentUser);
        const isCreator = (member === data.creator);
        
        let badgeClass = 'user-badge';
        if (isYou) badgeClass += ' you';
        if (isCreator) badgeClass += ' creator';
        
        let badgeText = member;
        if (isYou) badgeText += ' (Î•ÏƒÏ)';
        if (isCreator && !isYou) badgeText += ' ğŸ‘‘';
        
        return `<div class="${badgeClass}">${badgeText}</div>`;
      }).join('');
      
      const userCount = uniqueMembers.length;
      buttonText.textContent = `Î£Ï…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿${userCount > 1 ? 'Î¹' : ''} (${userCount})`;
      
    } else {
      connectedUsers.style.display = 'none';
    }
    
    syncInfo.innerHTML = `<strong>Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼Î­Î½Î¿:</strong> ${data.name || currentBudget} | ÎšÏ‰Î´Î¹ÎºÏŒÏ‚: <strong>${currentBudget}</strong>`;
    
  } else if (status === 'connecting') {
    mainDot.className = 'sync-status-dot sync-connecting';
    headerDot.className = 'sync-status-dot sync-connecting';
    buttonText.textContent = 'Î£Ï…Î½Î´Î­ÎµÏ„Î±Î¹...';
    syncInfo.innerHTML = 'Î£ÏÎ½Î´ÎµÏƒÎ· ÏƒÎµ cloud...';
    connectedUsers.style.display = 'none';
    
  } else {
    mainDot.className = 'sync-status-dot sync-offline';
    headerDot.className = 'sync-status-dot sync-offline';
    buttonText.textContent = 'Î£Ï…Î½Î´Î­ÏƒÎ¿Ï…';
    syncInfo.innerHTML = 'Î§Ï‰ÏÎ¯Ï‚ ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ - Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï„Î¿Ï€Î¹ÎºÎ¬';
    connectedUsers.style.display = 'none';
  }
}

// ==================== Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ Î‘Î¡Î§Î•Î™ÎŸÎ˜Î•Î¤Î—Î£Î—Î£ - Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ•Î£ ====================
function saveArchivedBudget() {
  const currentMonth = document.getElementById('month').value;
  if (!currentMonth) {
    showQuickMessage('âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿Ï‚ Î¼Î®Î½Î±Ï‚ Î³Î¹Î± Î±ÏÏ‡ÎµÎ¹Î¿Î¸Î­Ï„Î·ÏƒÎ·', 'error');
    return;
  }
  
  const currentExpenses = expenses.filter(e => e.date.startsWith(currentMonth));
  
  if (currentExpenses.length === 0 && categories.length === 0) {
    showQuickMessage('âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Î±ÏÏ‡ÎµÎ¹Î¿Î¸Î­Ï„Î·ÏƒÎ·', 'error');
    return;
  }
  
  const archiveKey = `budget_archive_${currentMonth}`;
  const archiveData = {
    month: currentMonth,
    expenses: currentExpenses,
    categories: [...categories],
    recurringAmounts: {...recurringAmounts},
    income: income,
    bankBalances: {...bankBalances},
    savedAt: new Date().toISOString()
  };
  
  localStorage.setItem(archiveKey, JSON.stringify(archiveData));
  showQuickMessage(`ğŸ“ Î‘ÏÏ‡ÎµÎ¹Î¿Î¸ÎµÏ„Î®Î¸Î·ÎºÎµ Î¿ Î¼Î®Î½Î±Ï‚ ${currentMonth}`, 'success');
}

function showArchivedBudgets() {
  const archiveKeys = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith('budget_archive_')) {
      archiveKeys.push(key);
    }
  }
  
  if (archiveKeys.length === 0) {
    showQuickMessage('ğŸ“­ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±ÏÏ‡ÎµÎ¹Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î¿Î¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯', 'info');
    return;
  }
  
  let content = '<h3>ğŸ“ Î‘ÏÏ‡ÎµÎ¹Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î¿Î¹ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯</h3>';
  
  archiveKeys.forEach(key => {
    try {
      const data = JSON.parse(localStorage.getItem(key));
      const month = data.month;
      const expenseCount = data.expenses?.length || 0;
      const total = data.expenses?.reduce((sum, e) => sum + e.amount, 0) || 0;
      
      content += `
        <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #9c27b0;">
          <strong>${month}</strong>
          <div style="font-size: 14px; color: #666;">
            ÎˆÎ¾Î¿Î´Î±: ${expenseCount} | Î£ÏÎ½Î¿Î»Î¿: ${total.toFixed(2)}â‚¬ | ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚: ${data.categories?.length || 0}
          </div>
          <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button onclick="loadArchivedBudget('${key}')" style="padding: 8px 15px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px; flex: 1;">
              ğŸ”„ Î¦ÏŒÏÏ„Ï‰ÏƒÎ·
            </button>
            <button onclick="deleteArchivedBudget('${key}')" style="padding: 8px 15px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px; flex: 1;">
              ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î®
            </button>
          </div>
        </div>
      `;
    } catch (e) {
      console.error('Error loading archive:', e);
    }
  });
  
  showCustomModal('Î‘ÏÏ‡ÎµÎ¹Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î¿Î¹ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯', content);
}

function showCustomModal(title, content) {
  document.getElementById('customModalTitle').textContent = title;
  document.getElementById('customModalBody').innerHTML = content;
  document.getElementById('customModal').style.display = 'flex';
  
  // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎºÎ»ÎµÎ¹ÏƒÎ¯Î¼Î±Ï„Î¿Ï‚ Î¼Îµ Ï„Î¿ ESC
  const closeOnEsc = (e) => {
    if (e.key === 'Escape') closeCustomModal();
  };
  
  document.addEventListener('keydown', closeOnEsc);
  document.getElementById('customModal')._closeOnEsc = closeOnEsc;
}

function closeCustomModal() {
  const modal = document.getElementById('customModal');
  if (modal) {
    document.removeEventListener('keydown', modal._closeOnEsc);
    modal.style.display = 'none';
  }
}

function loadArchivedBudget(key) {
  try {
    const data = JSON.parse(localStorage.getItem(key));
    
    document.getElementById('month').value = data.month;
    expenses = data.expenses || [];
    categories = data.categories || [];
    recurringAmounts = data.recurringAmounts || {};
    income = data.income || 0;
    bankBalances = data.bankBalances || {};
    
    document.getElementById('income').value = income;
    
    saveAllData();
    initFields();
    render();
    
    closeCustomModal();
    showQuickMessage(`âœ… Î¦Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ Î¿ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ${data.month}`, 'success');
  } catch (e) {
    showQuickMessage('âŒ Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï…', 'error');
  }
}

function deleteArchivedBudget(key) {
  if (confirm('Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¹Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î¿ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ;')) {
    localStorage.removeItem(key);
    showArchivedBudgets();
    showQuickMessage('ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿', 'success');
  }
}

function showNewBudgetModal() {
  const content = `
    <div style="text-align: center; padding: 20px;">
      <h3 style="color: #9c27b0;">ğŸ“… Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎÎ­Î¿Ï… Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï</h3>
      <p>Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï Î³Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ Î¼Î®Î½Î±:</p>
      
      <div style="margin: 20px 0;">
        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎœÎ®Î½Î±:</label>
        <input type="month" id="newBudgetMonth" value="${new Date().toISOString().slice(0,7)}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px;">
      </div>
      
      <div style="margin: 20px 0;">
        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Î¤Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ:</label>
        <select id="budgetAction" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd;">
          <option value="new">âœ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½Ï„ÎµÎ»ÏÏ‚ Î½Î­Î¿Ï… (Î¬Î´ÎµÎ¹Î±Ï‚ Î»Î¯ÏƒÏ„Î±Ï‚)</option>
          <option value="copy" selected>ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î¼Î®Î½Î±</option>
          <option value="archive">ğŸ“ Î‘ÏÏ‡ÎµÎ¹Î¿Î¸Î­Ï„Î·ÏƒÎ· Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ ÎºÎ±Î¹ Î½Î­Î¿</option>
        </select>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 30px;">
        <button onclick="closeCustomModal()" style="padding: 12px; background: #f0f0f0; color: #333; border: none; border-radius: 8px; cursor: pointer;">
          Î‘ÎºÏÏÏ‰ÏƒÎ·
        </button>
        <button onclick="createNewMonthlyBudget()" style="padding: 12px; background: #9c27b0; color: white; border: none; border-radius: 8px; cursor: pointer;">
          Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±
        </button>
      </div>
    </div>
  `;
  
  showCustomModal('Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎÎ­Î¿Ï… ÎœÎ®Î½Î±', content);
}

function createNewMonthlyBudget() {
  const month = document.getElementById('newBudgetMonth').value;
  const action = document.getElementById('budgetAction').value;
  
  if (!month) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î¼Î®Î½Î±', 'error');
    return;
  }
  
  // Î‘ÏÏ‡ÎµÎ¹Î¿Î¸Î­Ï„Î·ÏƒÎ· Î Î¡Î™Î Ï„Î·Î½ Î±Î»Î»Î±Î³Î® Î¼Î®Î½Î± (Î¼ÏŒÎ½Î¿ Î±Î½ Ï„Î¿ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚)
  if (action === 'archive') {
    const currentMonth = document.getElementById('month').value;
    const currentExpenses = expenses.filter(e => e.date.startsWith(currentMonth));
    
    if (currentExpenses.length > 0) {
      const archiveKey = `budget_archive_${currentMonth}`;
      const archiveData = {
        month: currentMonth,
        expenses: currentExpenses,
        categories: [...categories],
        recurringAmounts: {...recurringAmounts},
        income: income,
        bankBalances: {...bankBalances},
        savedAt: new Date().toISOString()
      };
      localStorage.setItem(archiveKey, JSON.stringify(archiveData));
      showQuickMessage(`ğŸ“ Î‘ÏÏ‡ÎµÎ¹Î¿Î¸ÎµÏ„Î®Î¸Î·ÎºÎµ Î¿ Î¼Î®Î½Î±Ï‚ ${currentMonth}`, 'success');
    }
  }
  
  // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Ï‰Î½ Î¤Î¡Î•Î§ÎŸÎÎ¤Î©Î Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î Î¡Î™Î Ï„Î·Î½ Î±Î»Î»Î±Î³Î® (Î³Î¹Î± Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î®)
  const currentCategories = [...categories];
  const currentRecurringAmounts = {...recurringAmounts};
  const currentIncome = income;
  const currentBankBalances = {...bankBalances};
  
  // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… Î¼Î®Î½Î± ÏƒÏ„Î¿ UI
  document.getElementById('month').value = month;
  
  // Î‘Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¹Î»Î¿Î³Î®
  if (action === 'new') {
    // Î•ÎšÎ¤Î•Î›Î•Î£Î—: Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… (Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î¼ÏŒÎ½Î¿ ÎµÏ€Î±Î½Î±Î»Î±Î¼Î²Î±Î½ÏŒÎ¼ÎµÎ½Ï‰Î½)
    const selectedMonth = month;
    expenses = expenses.filter(e => e.isRecurring === true);
    
    // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¹ÏÎ½ Î³Î¹Î± ÎµÏ€Î±Î½Î±Î»Î±Î¼Î²Î±Î½ÏŒÎ¼ÎµÎ½Î±
    expenses.forEach(e => {
      if (e.isRecurring) {
        e.date = selectedMonth + '-01';
      }
    });
    
    // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÏÎ½ ÎºÎ±Î¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½
    categories = [...currentCategories];
    recurringAmounts = {...currentRecurringAmounts};
    
    showQuickMessage(`âœ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î½Î­Î¿Ï‚ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î³Î¹Î± ${month}`, 'success');
    
  } else if (action === 'copy') {
    // Î•ÎšÎ¤Î•Î›Î•Î£Î—: Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® ÎŸÎ›Î©Î Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î¼Î®Î½Î±
    // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÏÎ½, Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½, ÎµÎ¹ÏƒÎ¿Î´Î®Î¼Î±Ï„Î¿Ï‚ ÎºÎ±Î¹ Ï„ÏÎ±Ï€ÎµÎ¶Î¹ÎºÏÎ½ Ï…Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½
    categories = [...currentCategories];
    recurringAmounts = {...currentRecurringAmounts};
    income = currentIncome;
    bankBalances = currentBankBalances;
    
    // Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÎµÎ¾ÏŒÎ´Ï‰Î½, Î±Î»Î»Î¬ Î±Î»Î»Î±Î³Î® Î¼ÏŒÎ½Î¿ Ï„Î¿Ï… Î¼Î®Î½Î± ÏƒÎµ Î±Ï…Ï„Î¬ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï„Î¿Ï… Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚
    const oldMonth = document.getElementById('month').value;
    expenses.forEach(e => {
      if (e.date.startsWith(oldMonth)) {
        e.date = month + e.date.substring(7); // Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Î¿Ï… Î¼Î®Î½Î±
      }
    });
    
    showQuickMessage(`ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎ±Î½ ÏŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± ${month}`, 'success');
  }
  
  // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ modal ÎºÎ±Î¹ Î±Î½Î±Î½Î­Ï‰ÏƒÎ·
  closeCustomModal();
  saveAllData();
  render();
}

// ==================== Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ£ ====================
function initSync() {
  if (!currentBudget) {
    updateSyncUI('offline');
    return;
  }
  
  if (!firebase.apps.length) {
    const firebaseConfig = {
      apiKey: "AIzaSyBaItM0-eOAwU6snAxfMU_bcp9xW0UfYzQ",
      authDomain: "travelcosts-48d64.firebaseapp.com",
      databaseURL: "https://travelcosts-48d64-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "travelcosts-48d64",
      storageBucket: "travelcosts-48d64.firebasestorage.app",
      messagingSenderId: "792639383940",
      appId: "1:792639383940:web:ed991cc8426603015bd5d1"
    };
    firebase.initializeApp(firebaseConfig);
  }
  
  const database = firebase.database();
  firebaseRef = database.ref(`budgets/${currentBudget}`);
  
  updateSyncUI('connecting');
  
  let lastUpdateTime = 0;
  const UPDATE_COOLDOWN = 2000;
  
  firebaseRef.on('value', (snapshot) => {
    const now = Date.now();
    if (now - lastUpdateTime < UPDATE_COOLDOWN) {
      return;
    }
    
    const data = snapshot.val();
    if (data) {
      lastUpdateTime = now;
      
      const isCreator = (syncData.creator === currentUser);
      
      if (!isCreator) {
        if (data.categories && data.categories.length > 0) {
          categories = data.categories;
        }
        if (data.expenses && data.expenses.length > 0) {
          expenses = data.expenses;
        }
        if (data.recurringAmounts) {
          recurringAmounts = data.recurringAmounts;
        }
        if (data.income) {
          income = data.income;
          document.getElementById('income').value = income;
        }
        if (data.bankBalances) {
          bankBalances = data.bankBalances;
        }
        
        saveAllData();
        initFields();
        render();
      }
      
      syncData.budgetName = data.name;
      syncData.creator = data.creator;
      syncData.members = data.members || [currentUser];
      
      if (!syncData.members.includes(currentUser)) {
        syncData.members.push(currentUser);
        syncToFirebase();
      }
      
      localStorage.setItem('budgetbuddy_sync', JSON.stringify(syncData));
      updateSyncUI('online', data);
      
      if (syncData.justCreated) {
        showQuickMessage(`âœ… Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î¿ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ "${data.name}"`, 'success');
        delete syncData.justCreated;
        localStorage.setItem('budgetbuddy_sync', JSON.stringify(syncData));
      }
      
    } else {
      if (syncData.creator === currentUser) {
        createNewBudgetInFirebase();
      }
    }
  }, (error) => {
    console.error("Firebase error:", error);
    updateSyncUI('offline');
  });
}

function createNewBudgetInFirebase() {
  if (!currentBudget) return;
  
  const budgetName = syncData.budgetName || `Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ${currentBudget}`;
  
  const newBudget = {
    code: currentBudget,
    name: budgetName,
    creator: currentUser,
    created: Date.now(),
    members: [currentUser],
    categories: categories.length > 0 ? categories : ['Î£Î¿ÏÏ€ÎµÏ ÎœÎ¬ÏÎºÎµÏ„', 'ÎÎ¿Î¯ÎºÎ¹', 'Î—Î»ÎµÎºÏ„ÏÎ¹ÎºÏŒ', 'ÎÎµÏÏŒ', 'Î¤Î·Î»Î­Ï†Ï‰Î½Î±', 'ÎšÎ±ÏÏƒÎ¹Î¼Î±', 'Î¨Ï…Ï‡Î±Î³Ï‰Î³Î¯Î±'],
    expenses: expenses,
    recurringAmounts: recurringAmounts,
    income: income,
    bankBalances: bankBalances,
    lastUpdated: Date.now()
  };
  
  firebaseRef.set(newBudget)
    .then(() => {
      updateSyncUI('online', newBudget);
    })
    .catch(error => {
      console.error("Firebase create error:", error);
      updateSyncUI('offline');
    });
}

function syncToFirebase() {
  if (!currentBudget || !firebaseRef) return;
  
  if (window.syncTimeout) {
    clearTimeout(window.syncTimeout);
  }
  
  window.syncTimeout = setTimeout(() => {
    const budgetData = {
      code: currentBudget,
      name: syncData.budgetName || `Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ${currentBudget}`,
      creator: syncData.creator || currentUser,
      members: syncData.members || [currentUser],
      categories: categories,
      expenses: expenses,
      recurringAmounts: recurringAmounts,
      income: income,
      bankBalances: bankBalances,
      lastUpdated: Date.now()
    };
    
    firebaseRef.set(budgetData);
  }, 1000);
}

// ==================== MODAL ÎšÎ©Î”Î™ÎšÎŸÎ¥ ====================
let generatedCodeForSharing = null;

function showCodeModal(code) {
  generatedCodeForSharing = code;
  document.getElementById('generatedCode').textContent = code;
  document.getElementById('codeModal').style.display = 'flex';
}

function closeCodeModal() {
  document.getElementById('codeModal').style.display = 'none';
}

function showQRForCode() {
  if (!generatedCodeForSharing) return;
  
  const qrData = {
    app: "BudgetBuddy",
    code: generatedCodeForSharing,
    name: syncData.budgetName || "Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚",
    type: "join"
  };
  
  const qrText = JSON.stringify(qrData);
  const qrContainer = document.createElement('div');
  qrContainer.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 4000;
    padding: 20px;
  `;
  
  QRCode.toCanvas(qrText, { width: 250 }, function(error, canvas) {
    if (error) {
      console.error('QR error:', error);
      return;
    }
    
    qrContainer.innerHTML = `
      <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 300px;">
        <h2 style="color: #e91e63; margin-top: 0;">ğŸ“± Î£Î¥ÎÎ”Î•Î£Î—</h2>
        <p>Î£ÎºÎ±Î½Î¬ÏÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ QR code Î¼Îµ Ï„Î¿ Î¬Î»Î»Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ:</p>
        <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 10px;">
          ${canvas.outerHTML}
        </div>
        <h3 style="font-family: monospace; letter-spacing: 3px; color: #333; margin: 15px 0;">${generatedCodeForSharing}</h3>
        <p style="color: #666;">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚: <strong>${generatedCodeForSharing}</strong></p>
        <button onclick="this.parentElement.parentElement.remove()" style="padding: 10px 25px; background: #e91e63; color: white; border: none; border-radius: 8px; margin-top: 15px; cursor: pointer;">
          ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿
        </button>
      </div>
    `;
    
    document.body.appendChild(qrContainer);
  });
}

function copyGeneratedCode() {
  if (!generatedCodeForSharing) return;
  
  navigator.clipboard.writeText(generatedCodeForSharing).then(() => {
    showQuickMessage('ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!', 'success');
  }).catch(() => {
    const tempInput = document.createElement('input');
    tempInput.value = generatedCodeForSharing;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    showQuickMessage('ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!', 'success');
  });
}

// ==================== MODAL Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ¥ ====================
function showSyncModal() {
  const modal = document.getElementById('syncModal');
  const content = document.getElementById('syncModalContent');
  
  if (currentBudget) {
    content.innerHTML = `
      <div class="sync-modal-section">
        <h3>âœ… Î•Î¯ÏƒÏ„Îµ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Î¹!</h3>
        <p><strong>Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚:</strong> ${syncData.budgetName || currentBudget}</p>
        <p><strong>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚:</strong></p>
        <div style="text-align: center; margin: 15px 0;">
          <div style="font-size: 32px; font-weight: bold; letter-spacing: 3px; color: #e91e63; background: #f9f9f9; padding: 15px; border-radius: 10px;">
            ${currentBudget}
          </div>
        </div>
        <p><small>Î”ÏÏƒÏ„Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ ÏƒÏ„Î¿Î½ ÏƒÏÎ¶Ï…Î³Î¿/ÏƒÏÎ¶Ï…Î³Î¿ Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯</small></p>
      </div>
      
      <div class="sync-modal-section">
        <h3>ğŸ“± ÎšÎ¿Î¹Î½Î® Ï‡ÏÎ®ÏƒÎ·</h3>
        <button onclick="showQRCode()" style="width: 100%; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; margin-bottom: 10px; cursor: pointer;">
          ğŸ´ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· QR Code
        </button>
        <button onclick="copySyncCode()" style="width: 100%; padding: 12px; background: #2196f3; color: white; border: none; border-radius: 8px; margin-bottom: 10px; cursor: pointer;">
          ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® ÎšÏ‰Î´Î¹ÎºÎ¿Ï
        </button>
        <button onclick="disconnectSync()" style="width: 100%; padding: 12px; background: #f44336; color: white; border: none; border-radius: 8px; cursor: pointer;">
          ğŸ”Œ Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·
        </button>
      </div>
    `;
  } else {
    content.innerHTML = `
      <div class="sync-modal-section">
        <h3>ğŸ”— Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï</h3>
        <p>Î£Ï…Î½Î´Î­ÏƒÏ„Îµ 2 Î® Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± ÎºÎ¹Î½Î·Ï„Î¬ Î³Î¹Î± Î½Î± Î­Ï‡ÎµÏ„Îµ Ï„Î± Î¯Î´Î¹Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿!</p>
      </div>
      
      <div class="sync-modal-section">
        <h3>ğŸš€ Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ ÎÎ•ÎŸÎ¥</h3>
        <p>Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÎ±Ï‚ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î½Î­Î¿ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ:</p>
        
        <div style="margin: 15px 0;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Î¤Î¿ ÎŒÎ½Î¿Î¼Î¬ Î£Î±Ï‚:</label>
          <input type="text" id="newUserName" value="${currentUser}" placeholder="Ï€.Ï‡. ÎœÎ±ÏÎ¯Î±" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        </div>
        
        <div style="margin: 15px 0;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">ÎŒÎ½Î¿Î¼Î± Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï:</label>
          <input type="text" id="newBudgetName" placeholder="Ï€.Ï‡. ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± Î™Î±Î½Î¿Ï…Î¬ÏÎ¹Î¿Ï‚" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        </div>
        
        <button onclick="createNewSync()" style="width: 100%; padding: 12px; background: #e91e63; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
          ğŸš€ Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ ÎÎ•ÎŸÎ¥ Î Î¡ÎŸÎ¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ¥
        </button>
      </div>
      
      <div class="sync-modal-section">
        <h3>ğŸ”— Î£Î¥ÎÎ”Î•Î£Î— Î£Î• Î¥Î Î‘Î¡Î§ÎŸÎ</h3>
        <p>ÎˆÏ‡ÎµÏ„Îµ Î®Î´Î· ÎºÏ‰Î´Î¹ÎºÏŒ Î±Ï€ÏŒ ÏƒÏÎ¶Ï…Î³Î¿/Ï†Î¯Î»Î¿;</p>
        
        <div style="margin: 15px 0;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">Î¤Î¿ ÎŒÎ½Î¿Î¼Î¬ Î£Î±Ï‚:</label>
          <input type="text" id="joinUserName" value="${currentUser}" placeholder="Ï€.Ï‡. Î“Î¹Î¬Î½Î½Î·Ï‚" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        </div>
        
        <div style="margin: 15px 0;">
          <label style="display: block; margin-bottom: 5px; font-weight: bold;">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï:</label>
          <input type="text" id="joinBudgetCode" placeholder="6 ÏˆÎ·Ï†Î¯Î±" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; text-align: center; letter-spacing: 3px; font-size: 18px;">
        </div>
        
        <button onclick="joinExistingSync()" style="width: 100%; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
          ğŸ”— Î£Î¥ÎÎ”Î•Î£Î— Î£Î• Î¥Î Î‘Î¡Î§ÎŸÎ Î Î¡ÎŸÎ¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸ
        </button>
      </div>
    `;
  }
  
  modal.style.display = 'flex';
}

function closeSyncModal() {
  document.getElementById('syncModal').style.display = 'none';
}

function createNewSync() {
  const userName = document.getElementById('newUserName').value.trim() || "ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±";
  const budgetName = document.getElementById('newBudgetName').value.trim() || "ÎŸÎ¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÏŒÏ‚ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚";
  
  if (!budgetName) {
    showQuickMessage('âš ï¸ Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ½Î¿Î¼Î± Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï', 'error');
    return;
  }
  
  currentUser = userName;
  currentBudget = generateSyncCode();
  
  syncData = {
    userName: userName,
    budgetCode: currentBudget,
    budgetName: budgetName,
    creator: userName,
    members: [userName],
    justCreated: true
  };
  
  localStorage.setItem('budgetbuddy_sync', JSON.stringify(syncData));
  
  closeSyncModal();
  showCodeModal(currentBudget);
  
  setTimeout(() => {
    initSync();
  }, 500);
}

function joinExistingSync() {
  const userName = document.getElementById('joinUserName').value.trim() || "ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±";
  const joinCode = document.getElementById('joinBudgetCode').value.trim().toUpperCase();
  
  if (!joinCode || joinCode.length !== 6) {
    showQuickMessage('âš ï¸ Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ 6-ÏˆÎ®Ï†Î¹Î¿ ÎºÏ‰Î´Î¹ÎºÏŒ', 'error');
    return;
  }
  
  currentUser = userName;
  currentBudget = joinCode;
  
  syncData = {
    userName: userName,
    budgetCode: joinCode,
    members: [userName]
  };
  
  localStorage.setItem('budgetbuddy_sync', JSON.stringify(syncData));
  
  closeSyncModal();
  showQuickMessage('ğŸ”— Î£Ï…Î½Î´Î­ÎµÏƒÏ„Îµ ÏƒÏ„Î¿Î½ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ...', 'info');
  
  setTimeout(() => {
    initSync();
  }, 500);
}

function showQRCode() {
  if (!currentBudget) return;
  
  const qrData = {
    app: "BudgetBuddy",
    code: currentBudget,
    name: syncData.budgetName || "Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚",
    type: "join"
  };
  
  const qrText = JSON.stringify(qrData);
  const qrContainer = document.createElement('div');
  qrContainer.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 3000;
    padding: 20px;
  `;
  
  QRCode.toCanvas(qrText, { width: 250 }, function(error, canvas) {
    if (error) {
      console.error('QR error:', error);
      return;
    }
    
    qrContainer.innerHTML = `
      <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 300px;">
        <h2 style="color: #e91e63; margin-top: 0;">ğŸ“± Î£Î¥ÎÎ”Î•Î£Î—</h2>
        <p>Î£ÎºÎ±Î½Î¬ÏÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ QR code Î¼Îµ Ï„Î¿ Î¬Î»Î»Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ:</p>
        <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 10px;">
          ${canvas.outerHTML}
        </div>
        <h3 style="font-family: monospace; letter-spacing: 3px; color: #333; margin: 15px 0;">${currentBudget}</h3>
        <p style="color: #666;">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚: <strong>${currentBudget}</strong></p>
        <button onclick="this.parentElement.parentElement.remove()" style="padding: 10px 25px; background: #e91e63; color: white; border: none; border-radius: 8px; margin-top: 15px; cursor: pointer;">
          ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿
        </button>
      </div>
    `;
    
    document.body.appendChild(qrContainer);
  });
}

function copySyncCode() {
  if (!currentBudget) return;
  
  navigator.clipboard.writeText(currentBudget).then(() => {
    showQuickMessage('ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!', 'success');
  }).catch(() => {
    const tempInput = document.createElement('input');
    tempInput.value = currentBudget;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    showQuickMessage('ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!', 'success');
  });
}

function disconnectSync() {
  if (confirm('Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î±Ï€Î¿ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Î±Ï€ÏŒ Ï„Î¿Î½ ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ;\nÎ¤Î± Ï„Î¿Ï€Î¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î¸Î± Ï€Î±ÏÎ±Î¼ÎµÎ¯Î½Î¿Ï…Î½.')) {
    if (firebaseRef) {
      firebaseRef.off();
    }
    
    currentBudget = null;
    syncData = {};
    localStorage.setItem('budgetbuddy_sync', JSON.stringify({}));
    
    closeSyncModal();
    updateSyncUI('offline');
    showQuickMessage('ğŸ”Œ Î‘Ï€Î¿ÏƒÏ…Î½Î´ÎµÎ¸Î®ÎºÎ±Ï„Îµ Î±Ï€ÏŒ ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ', 'success');
  }
}

function generateSyncCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 6; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

// ==================== ÎŸÎ™ Î Î‘Î›Î™Î•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ Î¤Î—Î£ Î•Î¦Î‘Î¡ÎœÎŸÎ“Î—Î£ ====================
function cleanupData() {
  categories = categories.filter(cat => cat && typeof cat === 'string' && cat.trim() !== '');
  
  const cleanRecurring = {};
  categories.forEach(cat => {
    if (recurringAmounts[cat] !== undefined) {
      const value = parseFloat(recurringAmounts[cat]);
      cleanRecurring[cat] = isNaN(value) ? 0 : value;
    }
  });
  recurringAmounts = cleanRecurring;
}

function saveAllData() {
  localStorage.setItem('cats', JSON.stringify(categories));
  localStorage.setItem('expenses', JSON.stringify(expenses));
  localStorage.setItem('recurringAmounts', JSON.stringify(recurringAmounts));
  localStorage.setItem('income', income);
  localStorage.setItem('bankBalances', JSON.stringify(bankBalances));
  
  if (currentBudget) {
    syncToFirebase();
  }
}

function initFields() {
  cleanupData();
  
  document.getElementById('income').value = income || '';
  
  const currentMonth = new Date().toISOString().slice(0,7);
  const monthInput = document.getElementById('month');
  if (!monthInput.value) {
    monthInput.value = currentMonth;
  }
  
  const today = new Date().toISOString().slice(0,10);
  document.getElementById('date').value = today;
  
  document.getElementById('alphaBank').value = bankBalances.alphaBank || '';
  document.getElementById('nationalBank').value = bankBalances.nationalBank || '';
  document.getElementById('cash').value = bankBalances.cash || '';
  document.getElementById('expectedIncome').value = bankBalances.expectedIncome || '';
  
  updateCategoriesList();
  updateRecurringInputs();
}

function saveBankBalances() {
  bankBalances = {
    alphaBank: parseFloat(document.getElementById('alphaBank').value) || 0,
    nationalBank: parseFloat(document.getElementById('nationalBank').value) || 0,
    cash: parseFloat(document.getElementById('cash').value) || 0,
    expectedIncome: parseFloat(document.getElementById('expectedIncome').value) || 0
  };
  
  saveAllData();
  showQuickMessage('ğŸ’° Î¤Î± Ï„ÏÎ±Ï€ÎµÎ¶Î¹ÎºÎ¬ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!', 'success');
  render();
}

function updateCategoriesList() {
  const categoriesListDiv = document.getElementById('categoriesList');
  let html = '';
  
  categories.forEach((category, index) => {
    html += `
      <div class="category-tag">
        ${category}
        <button onclick="deleteCategory(${index})" title="Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚">Ã—</button>
      </div>
    `;
  });
  
  categoriesListDiv.innerHTML = html || '<p style="color:#777;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚!</p>';
}

function addNewCategory() {
  const newCategoryInput = document.getElementById('newCategoryName');
  const categoryName = newCategoryInput.value.trim();
  
  if (!categoryName) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ ÏŒÎ½Î¿Î¼Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚', 'error');
    return;
  }
  
  if (categories.includes(categoryName)) {
    showQuickMessage('âš ï¸ Î— ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î·!', 'error');
    return;
  }
  
  categories.push(categoryName);
  newCategoryInput.value = '';
  
  saveAllData();
  updateCategoriesList();
  updateRecurringInputs();
  showQuickMessage(`âœ… Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ Î· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± "${categoryName}"`, 'success');
}

function deleteCategory(index) {
  const categoryName = categories[index];
  
  if (!confirm(`Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚ "${categoryName}";\nÎ˜Î± Î´Î¹Î±Î³ÏÎ±Ï†Î¿ÏÎ½ ÎºÎ±Î¹ ÏŒÎ»Î± Ï„Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î­Î¾Î¿Î´Î±!\nÎ£Î¯Î³Î¿Ï…ÏÎ±;`)) {
    return;
  }
  
  categories.splice(index, 1);
  expenses = expenses.filter(e => e.category !== categoryName);
  
  if (recurringAmounts[categoryName]) {
    delete recurringAmounts[categoryName];
  }
  
  saveAllData();
  updateCategoriesList();
  updateRecurringInputs();
  render();
  showQuickMessage(`ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ Î· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± "${categoryName}"`, 'success');
}

function updateRecurringInputs() {
  const recurringInputsDiv = document.getElementById('recurringInputs');
  
  if (categories.length === 0) {
    recurringInputsDiv.innerHTML = '<p style="color:#777; font-style:italic; padding: 10px;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÏÏ„Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚.</p>';
    return;
  }
  
  let html = `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">`;
  
  categories.forEach((category, index) => {
    const amount = recurringAmounts[category] || 0;
    const uniqueId = `recurring_${index}_${category.replace(/\s+/g, '_')}`;
    
    html += `
      <div style="background: white; padding: 12px; border-radius: 8px; border: 1px solid #eee; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 14px;">
          ${category}
        </label>
        <div style="display: flex; align-items: center; gap: 8px;">
          <input type="number" 
                 id="${uniqueId}" 
                 value="${amount}" 
                 step="0.01" 
                 style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"
                 placeholder="0.00"
                 onchange="updateSingleRecurringAmount('${category}', this.value)">
          <span style="color: #666; font-size: 14px;">â‚¬</span>
        </div>
      </div>
    `;
  });
  
  html += '</div>';
  recurringInputsDiv.innerHTML = html;
}

function updateSingleRecurringAmount(category, value) {
  const numValue = parseFloat(value) || 0;
  recurringAmounts[category] = numValue;
  
  saveAllData();
  showQuickMessage(`âœ… Î•Î½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ Î¿ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î³Î¹Î± ${category}: ${numValue.toFixed(2)}â‚¬`, 'success');
}

function saveRecurringAmounts() {
  if (categories.length === 0) {
    showQuickMessage('âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÏÏ„Î± ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚', 'error');
    return;
  }
  
  categories.forEach(category => {
    const inputs = document.querySelectorAll(`input[id^="recurring_"]`);
    let foundValue = recurringAmounts[category] || 0;
    
    inputs.forEach(input => {
      if (input.id.includes(category.replace(/\s+/g, '_')) || 
          input.previousElementSibling?.textContent?.includes(category)) {
        const value = parseFloat(input.value) || 0;
        foundValue = value;
      }
    });
    
    recurringAmounts[category] = foundValue;
  });
  
  saveAllData();
  showQuickMessage('ğŸ’¾ ÎŸÎ¹ Î¼Î·Î½Î¹Î±Î¯Î¿Î¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!', 'success');
  updateRecurringInputs();
  render();
}

function generateRecurringExpenses() {
  if (categories.length === 0) {
    showQuickMessage('âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÏÏ„Î± ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚', 'error');
    return;
  }
  
  const selectedMonth = document.getElementById('month').value;
  if (!selectedMonth) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏÏÏ„Î± Î­Î½Î± Î¼Î®Î½Î±!', 'error');
    return;
  }
  
  const monthExpenses = expenses.filter(e => e.date.startsWith(selectedMonth));
  const hasRecurringForMonth = monthExpenses.some(e => e.isRecurring === true);
  
  if (hasRecurringForMonth) {
    if (!confirm('Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î®Î´Î· ÎµÏ€Î±Î½Î±Î»Î±Î¼Î²Î±Î½ÏŒÎ¼ÎµÎ½Î± Î­Î¾Î¿Î´Î± Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Î¼Î®Î½Î±. Î˜Î­Î»ÎµÏ„Îµ Î½Î± Ï„Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î¾Î±Î½Î¬ (Î¸Î± Î´Î¹Î±Î³ÏÎ±Ï†Î¿ÏÎ½ Ï„Î± Ï€Î±Î»Î¹Î¬);')) {
      return;
    }
    
    expenses = expenses.filter(e => !(e.date.startsWith(selectedMonth) && e.isRecurring === true));
  }
  
  categories.forEach(category => {
    const amount = recurringAmounts[category] || 0;
    
    if (amount > 0) {
      const newExpense = {
        id: Date.now() + Math.random(),
        amount: amount,
        category: category,
        date: selectedMonth + '-01',
        note: 'ÎœÎ·Î½Î¹Î±Î¯Î¿ Î­Î¾Î¿Î´Î¿',
        isRecurring: true
      };
      
      expenses.push(newExpense);
    }
  });
  
  saveAllData();
  render();
  showQuickMessage(`ğŸ”„ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½ ÎµÏ€Î±Î½Î±Î»Î±Î¼Î²Î±Î½ÏŒÎ¼ÎµÎ½Î± Î­Î¾Î¿Î´Î± Î³Î¹Î± ${selectedMonth}`, 'success');
}

function addExpense() {
  if (categories.length === 0) {
    showQuickMessage('âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÏÏ„Î± ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚', 'error');
    return;
  }
  
  const amount = parseFloat(document.getElementById('amount').value);
  const category = document.getElementById('category').value;
  const date = document.getElementById('date').value;
  const note = document.getElementById('note').value.trim();
  
  if (!amount || amount <= 0) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î­Î½Î± Î­Î³ÎºÏ…ÏÎ¿ Ï€Î¿ÏƒÏŒ', 'error');
    document.getElementById('amount').focus();
    return;
  }
  
  if (!date) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±', 'error');
    document.getElementById('date').focus();
    return;
  }
  
  if (!category) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±', 'error');
    document.getElementById('category').focus();
    return;
  }
  
  const newExpense = {
    id: Date.now() + Math.random(),
    amount: amount,
    category: category,
    date: date,
    note: note || '-',
    isRecurring: false
  };
  
  expenses.push(newExpense);
  
  document.getElementById('amount').value = '';
  document.getElementById('note').value = '';
  
  saveAllData();
  render();
  showQuickMessage(`âœ… Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ Î­Î¾Î¿Î´Î¿ ${category} - ${amount.toFixed(2)}â‚¬`, 'success');
}

function deleteExpense(id) {
  if (!confirm('Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î­Î¾Î¿Î´Î¿;')) return;
  
  const index = expenses.findIndex(e => e.id === id);
  if (index === -1) return;
  
  const deletedExpense = expenses[index];
  expenses.splice(index, 1);
  
  saveAllData();
  render();
  showQuickMessage(`ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ Î­Î¾Î¿Î´Î¿ ${deletedExpense.amount.toFixed(2)}â‚¬ (${deletedExpense.category})`, 'success');
}

function render() {
  const categorySelect = document.getElementById('category');
  if (categories.length > 0) {
    categorySelect.innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join('');
  } else {
    categorySelect.innerHTML = '<option value="">Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÏÏ„Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚</option>';
  }
  
  const selectedMonth = document.getElementById('month').value;
  const filteredExpenses = selectedMonth 
    ? expenses.filter(e => e.date.startsWith(selectedMonth))
    : expenses;
  
  const tbody = document.querySelector('#expensesTable tbody');
  
  if (filteredExpenses.length === 0) {
    tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#777;padding:20px;">
      Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¼Î­Î½Î± Î­Î¾Î¿Î´Î± Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Î¼Î®Î½Î±.</td></tr>`;
  } else {
    tbody.innerHTML = filteredExpenses.map(e => `
      <tr>
        <td>${e.date}</td>
        <td>${e.category} ${e.isRecurring ? 'ğŸ”„' : ''}</td>
        <td>${e.note}</td>
        <td>${e.amount.toFixed(2)}</td>
        <td><button class='del' onclick='deleteExpense(${e.id})'>âœ•</button></td>
      </tr>
    `).join('');
  }
  
  const categorySummary = {};
  let actualExpenses = 0;
  let plannedExpenses = 0;
  
  categories.forEach(category => {
    const categoryExpenses = filteredExpenses.filter(e => e.category === category);
    const categoryTotal = categoryExpenses.reduce((sum, expense) => sum + expense.amount, 0);
    const categoryBudget = recurringAmounts[category] || 0;
    
    categorySummary[category] = {
      spent: categoryTotal,
      budget: categoryBudget,
      remaining: categoryBudget - categoryTotal
    };
    
    actualExpenses += categoryTotal;
    plannedExpenses += categoryBudget;
  });
  
  const catListDiv = document.getElementById('catList');
  let catHtml = '';
  
  if (categories.length === 0) {
    catHtml = '<p style="color:#777; font-style:italic; grid-column: 1/-1;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿ Ï„Î¼Î®Î¼Î± "Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÏÎ½".</p>';
  } else {
    categories.forEach(category => {
      const summary = categorySummary[category] || { spent: 0, budget: 0, remaining: 0 };
      const remaining = summary.remaining;
      const spentPercentage = summary.budget > 0 ? (summary.spent / summary.budget * 100).toFixed(1) : 0;
      
      let statusClass = '';
      if (remaining < 0) {
        statusClass = 'over';
      } else if (remaining > 0) {
        statusClass = 'under';
      }
      
      catHtml += `
        <div class="category-item ${statusClass}">
          <strong>${category}</strong><br>
          Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚: ${summary.budget.toFixed(2)} â‚¬<br>
          ÎÎ¿Î´ÎµÏÏ„Î·ÎºÎ±Î½: ${summary.spent.toFixed(2)} â‚¬<br>
          <strong>ÎœÎ­Î½Î¿Ï…Î½: ${remaining.toFixed(2)} â‚¬</strong><br>
          ${summary.budget > 0 ? `(${spentPercentage}%)` : ''}
        </div>
      `;
    });
  }
  
  catListDiv.innerHTML = catHtml;
  
  const totalSpent = actualExpenses;
  const remainingExpenses = plannedExpenses - actualExpenses;
  const currentMoney = (bankBalances.alphaBank || 0) + (bankBalances.nationalBank || 0) + (bankBalances.cash || 0);
  const futureMoney = bankBalances.expectedIncome || 0;
  const totalIncome = currentMoney + futureMoney;
  const finalBalance = totalIncome - totalSpent;
  
  document.getElementById('totalSpent').textContent = totalSpent.toFixed(2) + ' â‚¬';
  document.getElementById('remainingExpenses').textContent = remainingExpenses.toFixed(2) + ' â‚¬';
  document.getElementById('totalIncome').textContent = totalIncome.toFixed(2) + ' â‚¬';
  document.getElementById('finalBalance').textContent = finalBalance.toFixed(2) + ' â‚¬';
  
  const finalBalanceElement = document.getElementById('finalBalance');
  if (finalBalance < 0) {
    finalBalanceElement.style.color = '#f44336';
  } else if (finalBalance < totalIncome * 0.1) {
    finalBalanceElement.style.color = '#ff9800';
  } else {
    finalBalanceElement.style.color = '#4caf50';
  }
  
  updateStatistics(filteredExpenses, categories);
}

function updateStatistics(expenses, categories) {
  const statsGrid = document.getElementById('statsGrid');
  const expenseChart = document.getElementById('expenseChart');
  
  if (!statsGrid || !expenseChart) return;
  
  const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
  const avgExpense = expenses.length > 0 ? totalExpenses / expenses.length : 0;
  const maxExpense = expenses.length > 0 ? Math.max(...expenses.map(e => e.amount)) : 0;
  const minExpense = expenses.length > 0 ? Math.min(...expenses.map(e => e.amount)) : 0;
  const expenseCount = expenses.length;
  
  const categoryTotals = {};
  categories.forEach(cat => {
    categoryTotals[cat] = expenses
      .filter(e => e.category === cat)
      .reduce((sum, e) => sum + e.amount, 0);
  });
  
  const maxCategoryValue = Math.max(...Object.values(categoryTotals));
  
  statsGrid.innerHTML = `
    <div class="stat-box" style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
      <div class="stat-label" style="font-size: 12px; color: #666;">Î£Î¥ÎÎŸÎ›ÎŸ Î•ÎÎŸÎ”Î©Î</div>
      <div class="stat-value" style="font-size: 24px; font-weight: bold; color: #e91e63;">${totalExpenses.toFixed(2)}â‚¬</div>
    </div>
    <div class="stat-box" style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
      <div class="stat-label" style="font-size: 12px; color: #666;">Îœ.ÎŸ. Î•ÎÎŸÎ”ÎŸÎ¥</div>
      <div class="stat-value" style="font-size: 24px; font-weight: bold; color: #2196f3;">${avgExpense.toFixed(2)}â‚¬</div>
    </div>
    <div class="stat-box" style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
      <div class="stat-label" style="font-size: 12px; color: #666;">ÎœÎ•Î“Î‘Î›Î¥Î¤Î•Î¡ÎŸ</div>
      <div class="stat-value" style="font-size: 24px; font-weight: bold; color: #f44336;">${maxExpense.toFixed(2)}â‚¬</div>
    </div>
    <div class="stat-box" style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
      <div class="stat-label" style="font-size: 12px; color: #666;">Î•ÎÎŸÎ”Î‘ (Ï€Î»Î®Î¸Î¿Ï‚)</div>
      <div class="stat-value" style="font-size: 24px; font-weight: bold; color: #4caf50;">${expenseCount}</div>
    </div>
  `;
  
  if (maxCategoryValue > 0) {
    let chartHTML = '';
    categories.forEach(cat => {
      const value = categoryTotals[cat] || 0;
      const height = maxCategoryValue > 0 ? (value / maxCategoryValue * 100) : 0;
      const color = `hsl(${Math.random() * 360}, 70%, 60%)`;
      
      chartHTML += `
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
          <div style="width: 80%; background: ${color}; height: ${height}%; border-radius: 4px 4px 0 0; transition: height 0.5s;"></div>
          <div style="font-size: 11px; margin-top: 5px; text-align: center; color: #666; writing-mode: vertical-rl; transform: rotate(180deg); height: 60px; overflow: hidden; text-overflow: ellipsis;">
            ${cat}
          </div>
          <div style="font-size: 10px; color: #999; margin-top: 5px;">
            ${value.toFixed(0)}â‚¬
          </div>
        </div>
      `;
    });
    expenseChart.innerHTML = chartHTML;
  } else {
    expenseChart.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î­Î¾Î¿Î´Î± Î³Î¹Î± Î½Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ Î³ÏÎ¬Ï†Î·Î¼Î±</div>';
  }
}

function save() {
  cleanupData();
  income = parseFloat(document.getElementById('income').value) || 0;
  saveAllData();
  render();
}

// ==================== Î‘Î¡Î§Î™ÎšÎŸÎ ÎŸÎ™Î—Î£Î— ====================
window.onload = function() {
  const starsContainer = document.getElementById('stars');
  const starColors = ['#fff', '#ffd1e8', '#ffb6c1', '#ffc0cb'];
  
  for (let i = 0; i < 40; i++) {
    const star = document.createElement('div');
    star.classList.add('star');
    star.textContent = 'â˜…';
    star.style.left = Math.random() * 100 + '%';
    star.style.top = Math.random() * 100 + 'px';
    star.style.animationDelay = (Math.random() * 5) + 's';
    star.style.color = starColors[Math.floor(Math.random() * starColors.length)];
    starsContainer.appendChild(star);
  }
  
  const currentMonth = new Date().toISOString().slice(0,7);
  document.getElementById('month').value = currentMonth;
  
  const today = new Date().toISOString().slice(0,10);
  document.getElementById('date').value = today;
  
  initFields();
  render();
  
  document.getElementById('income').addEventListener('input', () => save());
  document.getElementById('month').addEventListener('input', () => render());
  
  initSync();
  
  setInterval(() => {
    if (currentBudget) {
      syncToFirebase();
    }
  }, 30000);
};
</script>
</body>
</html>
