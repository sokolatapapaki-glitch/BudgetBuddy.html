<!-- ÎŸÎ›ÎŸÎšÎ›Î—Î¡ÎŸÎ£ Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎŸÎ£ ÎšÎ©Î”Î™ÎšÎ‘Î£ -->
<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BudgetBuddy â€” ÎˆÎ¾Î¿Î´Î± Î£Ï€Î¹Ï„Î¹Î¿Ï</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>â‚¬</text></svg>">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>â‚¬</text></svg>">
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(to bottom, #ffe6f1, #fff0f7);
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }

  .stars {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 150px;
    overflow: hidden;
    z-index: 0;
  }

  .star {
    position: absolute;
    color: #fff;
    font-size: 18px;
    opacity: 0.8;
    animation: twinkle 5s infinite ease-in-out;
  }

  @keyframes twinkle {
    0%,100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.3); }
  }

  /* HEADER STYLES */
  .app-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: white;
    box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    z-index: 1000;
  }

  .header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid #f0f0f0;
  }

  .app-title {
    font-size: 1.3em;
    color: #e91e63;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* TABS STYLES */
  .tabs-container {
    display: flex;
    overflow-x: auto;
    background: white;
    border-bottom: 2px solid #f0f0f0;
    scrollbar-width: none;
  }

  .tabs-container::-webkit-scrollbar {
    display: none;
  }

  .tab {
    flex: 1;
    min-width: 120px;
    padding: 15px 10px;
    text-align: center;
    background: white;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: #666;
    white-space: nowrap;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .tab:hover {
    background: #f9f9f9;
    color: #e91e63;
  }

  .tab.active {
    background: #fff0f7;
    color: #e91e63;
    border-bottom-color: #e91e63;
    font-weight: 600;
  }

  /* MAIN CONTENT */
  .container {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 160px auto 20px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 25px 35px;
  }

  .tab-content {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
  }

  .tab-content.active {
    display: block;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* BUTTONS */
  .sync-button-header {
    background: #e91e63;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 2px 5px rgba(233, 30, 99, 0.3);
    transition: all 0.3s;
  }
  
  .sync-button-header:hover {
    background: #d81b60;
    transform: scale(1.05);
  }
  
  .sync-status-dot {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-left: 5px;
  }
  
  .sync-online { background: #4caf50; animation: pulse 2s infinite; }
  .sync-offline { background: #f44336; }
  .sync-connecting { background: #ff9800; animation: pulse 2s infinite; }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* ============ QUICK ADD FORM ============ */
  .quick-add-form {
    background: #fff0f7;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 4px 12px rgba(233, 30, 99, 0.1);
  }

  .first-row {
    display: flex;
    gap: 10px;
    margin-bottom: 12px;
    align-items: flex-end;
  }

  .amount-group {
    flex: 1;
  }

  .add-button-group {
    flex-shrink: 0;
    width: 50px;
  }

  .second-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
  }

  .note-row {
    margin-bottom: 0;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group label {
    margin-bottom: 5px;
    font-weight: 500;
    color: #e91e63;
    font-size: 13px;
  }

  .amount-input-wrapper {
    position: relative;
    width: 100%;
  }

  .amount-input-wrapper::before {
    content: "â‚¬";
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: #e91e63;
    font-weight: bold;
    z-index: 1;
    font-size: 16px;
  }

  .amount-input-wrapper input {
    padding-left: 35px !important;
    font-size: 16px;
    height: 45px;
  }

  input, select, button {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 15px;
    box-sizing: border-box;
  }

  button {
    cursor: pointer;
    transition: all 0.3s;
  }

  button.add { 
    background: #e91e63; 
    color: white; 
    border: none; 
    font-weight: bold;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    width: 100%;
    height: 45px;
    min-width: 45px;
  }

  button.add:hover {
    background: #d81b60;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
  }

  .delete-expense-btn {
    background: #f44336;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 5px 8px;
    cursor: pointer;
    font-size: 12px;
    margin-left: 10px;
    transition: all 0.3s;
  }

  .delete-expense-btn:hover {
    background: #d32f2f;
    transform: scale(1.1);
  }

  .category-tag {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 15px;
    background: #e91e63;
    color: white;
    border-radius: 20px;
    font-size: 14px;
    box-shadow: 0 2px 5px rgba(233, 30, 99, 0.2);
    cursor: grab;
    user-select: none;
    transition: all 0.3s;
  }

  .category-tag:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(233, 30, 99, 0.3);
  }

  .category-tag:active {
    cursor: grabbing;
    transform: scale(1.05);
    box-shadow: 0 6px 12px rgba(233, 30, 99, 0.4);
  }

  .category-tag.dragging {
    opacity: 0.5;
    background: #ff80ab;
  }

  .categories-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 15px 0;
    min-height: 50px;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 10px;
    border: 2px dashed #e0e0e0;
  }

  .categories-list.drag-over {
    background: #f0f8ff;
    border-color: #e91e63;
  }

  /* BUDGET OVERVIEW - TAB 2 */
  .budget-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }

  .budget-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    border-left: 5px solid #e91e63;
    transition: all 0.3s;
  }

  .budget-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  }

  .budget-card.over {
    border-left-color: #f44336;
  }

  .budget-card.under {
    border-left-color: #4caf50;
  }

  .budget-card.savings {
    border-left-color: #ff9800;
  }

  .progress-bar {
    height: 8px;
    background: #f0f0f0;
    border-radius: 4px;
    margin: 15px 0;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(to right, #e91e63, #ff80ab);
    border-radius: 4px;
    transition: width 0.5s ease-in-out;
  }

  /* BANK BALANCES - TAB 3 */
  .bank-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }

  .bank-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    text-align: center;
    border-top: 5px solid #9c27b0;
  }

  .bank-card h4 {
    margin: 0 0 15px 0;
    color: #333;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  /* SETTINGS - TAB 4 */
  .settings-section {
    background: #f9f9f9;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .settings-section h3 {
    color: #e91e63;
    margin-top: 0;
    border-bottom: 2px solid #ffe6f1;
    padding-bottom: 10px;
  }

  /* MODALS */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 3000;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  
  .modal-content {
    background: white;
    border-radius: 15px;
    padding: 30px;
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }

  /* RECENT EXPENSES */
  .recent-expenses-container {
    max-height: 300px;
    overflow-y: auto;
    margin-top: 15px;
    border-radius: 10px;
    border: 1px solid #eee;
  }

  .expense-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    background: white;
    border-bottom: 1px solid #f0f0f0;
    transition: background 0.2s;
  }

  .expense-item:last-child {
    border-bottom: none;
  }

  .expense-item:hover {
    background: #f9f9f9;
  }

  .expense-info {
    flex: 1;
  }

  .expense-category {
    font-weight: bold;
    color: #333;
  }

  .expense-details {
    font-size: 12px;
    color: #666;
    margin-top: 2px;
  }

  .expense-amount {
    font-weight: bold;
    color: #e91e63;
    font-size: 16px;
  }

  /* ÎœÎ—ÎÎ‘Î£ SELECTOR */
  .month-selector {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    background: linear-gradient(to right, #e1f5fe, #f3e5f5);
    padding: 15px;
    border-radius: 10px;
  }

  .month-selector select, .month-selector button {
    padding: 10px 15px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 15px;
  }

  .month-selector button {
    background: #e91e63;
    color: white;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
  }

  .month-selector button:hover {
    background: #d81b60;
    transform: translateY(-2px);
  }

  /* ÎŸÎ™ 3 ÎšÎ‘Î™ÎÎŸÎ¥Î¡Î“Î™Î•Î£ ÎšÎ‘Î¡Î¤Î•Î£ Î£Î¤Î—Î ÎšÎ‘Î¡Î¤Î•Î›Î‘ 1 */
  .financial-overview {
    background: linear-gradient(to bottom, #f8f9ff, #f5f7ff);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    border: 1px solid #e0e0ff;
  }

  .financial-card {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    border-left: 4px solid;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  .financial-card:last-child {
    margin-bottom: 0;
  }

  .financial-card.manual {
    border-left-color: #2196f3;
  }

  .financial-card.pending {
    border-left-color: #ff9800;
  }

  .financial-card.app {
    border-left-color: #9c27b0;
  }

  .financial-card h4 {
    margin: 0 0 10px 0;
    color: #333;
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .financial-amount {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 5px;
  }

  .financial-details {
    font-size: 12px;
    color: #666;
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid #eee;
  }

  .financial-details div {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
  }

  /* SETTING FOR APP BALANCE */
  .app-balance-input {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .app-balance-input input {
    flex: 1;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ddd;
  }

  .app-balance-input button {
    background: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 15px;
    cursor: pointer;
  }

  .app-balance-input button:hover {
    background: #45a049;
  }

  /* TRANSFER SYSTEM */
  .transfer-system {
    background: linear-gradient(to right, #fff8e1, #f3e5f5);
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 25px;
    border: 1px solid #ffe0b2;
  }

  .transfer-history-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: white;
    border-radius: 6px;
    margin-bottom: 6px;
    border-left: 3px solid #ff9800;
    font-size: 13px;
  }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    .container {
      margin: 140px 10px 20px;
      padding: 15px 20px;
    }

    .header-top {
      padding: 10px 15px;
    }

    .tab {
      min-width: 100px;
      padding: 12px 8px;
      font-size: 13px;
    }

    .quick-add-form {
      padding: 12px;
    }

    .first-row {
      flex-direction: row;
      gap: 8px;
    }

    .add-button-group {
      width: 50px;
    }

    button.add {
      width: 100%;
      min-width: unset;
    }

    .second-row {
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .budget-cards,
    .bank-cards {
      grid-template-columns: 1fr;
    }

    input, select, button {
      font-size: 14px;
      padding: 8px;
    }

    .amount-input-wrapper input,
    button.add {
      height: 42px;
    }
    
    .amount-input-wrapper input {
      padding-left: 30px !important;
    }
    
    .amount-input-wrapper::before {
      left: 8px;
      font-size: 14px;
    }
    
    .category-tag {
      padding: 6px 12px;
      font-size: 13px;
    }
    
    .month-selector {
      flex-wrap: wrap;
    }
    
    .financial-overview {
      padding: 15px;
    }
    
    .financial-amount {
      font-size: 20px;
    }
    
    .app-balance-input {
      flex-direction: column;
    }

    .transfer-system .transfer-controls {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .app-title {
      font-size: 1.1em;
    }

    .tab {
      min-width: 80px;
      font-size: 12px;
      padding: 10px 5px;
    }

    .container {
      margin: 130px 5px 10px;
      padding: 10px 15px;
    }

    .quick-add-form {
      padding: 10px;
    }
    
    .first-row {
      gap: 5px;
    }
    
    .second-row {
      gap: 8px;
    }

    button.add {
      font-size: 20px;
    }
    
    .month-selector button {
      padding: 8px 12px;
      font-size: 13px;
    }
  }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #777;
    background: #f9f9f9;
    border-radius: 10px;
    font-style: italic;
  }
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>

<div class="stars" id="stars"></div>

<!-- HEADER -->
<div class="app-header">
  <div class="header-top">
    <div class="app-title">
      ğŸŒ¸ BudgetBuddy
    </div>
    <button class="sync-button-header" onclick="showSyncModal()" id="mainSyncButton">
      <span id="syncButtonText">Î£Ï…Î½Î´Î­ÏƒÎ¿Ï…</span>
      <span class="sync-status-dot" id="mainSyncDot"></span>
    </button>
  </div>

  <!-- TABS -->
  <div class="tabs-container">
    <button class="tab active" onclick="switchTab(1)">
      <span>ğŸ“</span> Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·
    </button>
    <button class="tab" onclick="switchTab(2)">
      <span>ğŸ“Š</span> Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î±
    </button>
    <button class="tab" onclick="switchTab(3)">
      <span>ğŸ’°</span> Î¤ÏÎ¬Ï€ÎµÎ¶ÎµÏ‚
    </button>
    <button class="tab" onclick="switchTab(4)">
      <span>âš™ï¸</span> Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚
    </button>
  </div>
</div>

<!-- MAIN CONTAINER -->
<div class="container">
  
  <!-- TAB 1: Î Î¡ÎŸÎ£Î˜Î—ÎšÎ— -->
  <div id="tab1" class="tab-content active">
    <!-- ÎœÎ—ÎÎ‘Î£ SELECTOR -->
    <div class="month-selector">
      <span style="font-weight: bold; color: #e91e63;">ğŸ“… Î¤ÏÎ­Ï‡Ï‰Î½ Î¼Î®Î½Î±Ï‚:</span>
      <select id="monthSelect"></select>
      <button onclick="resetCurrentMonth()">ğŸ”„ Î•ÎºÎºÎ±Î¸Î¬ÏÎ¹ÏƒÎ· Î¼Î®Î½Î±</button>
      <button onclick="createNewMonth()" style="background: #4caf50;">â• ÎÎ­Î¿Ï‚ Î¼Î®Î½Î±Ï‚</button>
    </div>

    <div class="quick-add-form">
      <div class="first-row">
        <div class="amount-group form-group">
          <label>ğŸ’° Î Î¿ÏƒÏŒ (â‚¬)</label>
          <div class="amount-input-wrapper">
            <input type="number" id="amount" step="0.01" placeholder="0.00" min="0.01" autocomplete="off">
          </div>
        </div>
        
        <div class="add-button-group">
          <button class="add" onclick="addExpense()" id="addExpenseButton" title="Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÎ¾ÏŒÎ´Î¿Ï…">
            <span>â•</span>
          </button>
        </div>
      </div>
      
      <div class="second-row">
        <div class="form-group">
          <label>ğŸ“‚ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</label>
          <select id="category"></select>
        </div>
        
        <div class="form-group">
          <label>ğŸ“… Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</label>
          <input type="date" id="date" value="">
        </div>
      </div>
      
      <div class="form-group note-row">
        <label>ğŸ“ Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
        <input type="text" id="note" placeholder="Ï€.Ï‡. ÏˆÏÎ½Î¹Î± ÏƒÎ¿ÏÏ€ÎµÏ Î¼Î¬ÏÎºÎµÏ„" autocomplete="off">
      </div>
    </div>

    <!-- ÎŸÎ™ 3 ÎšÎ‘Î¡Î¤Î•Î£ -->
    <div class="financial-overview">
      <h3 style="margin-top: 0; color: #333; text-align: center; margin-bottom: 15px;">ğŸ’° Î£Î¥ÎÎŸÎ›Î™ÎšÎ— ÎŸÎ™ÎšÎŸÎÎŸÎœÎ™ÎšÎ— Î•Î™ÎšÎŸÎÎ‘</h3>
      
      <!-- ÎšÎ‘Î¡Î¤Î‘ 1: Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î§Î•Î™Î¡ÎŸÎšÎ™ÎÎ—Î¤Î‘ -->
      <div class="financial-card manual">
        <h4>ğŸ’° Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î§Î•Î™Î¡ÎŸÎšÎ™ÎÎ—Î¤Î‘</h4>
        <div class="financial-amount" id="totalManualDisplay">0.00 â‚¬</div>
        <div class="financial-details" id="manualDetails">
          <div><span>Î‘Î»Ï†Î± Î¤ÏÎ¬Ï€ÎµÎ¶Î±:</span> <span id="alphaAmount">0.00 â‚¬</span></div>
          <div><span>Î•Î¸Î½Î¹ÎºÎ® Î¤ÏÎ¬Ï€ÎµÎ¶Î±:</span> <span id="nationalAmount">0.00 â‚¬</span></div>
          <div><span>ÎœÎµÏ„ÏÎ·Ï„Î¬:</span> <span id="cashAmount">0.00 â‚¬</span></div>
          <div><span>Î˜Î± Ï€Î¬ÏÏ‰ Î±ÎºÏŒÎ¼Î±:</span> <span id="expectedAmount">0.00 â‚¬</span></div>
        </div>
      </div>
      
      <!-- ÎšÎ‘Î¡Î¤Î‘ 2: Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î Î¡ÎŸÎ£ Î Î›Î—Î¡Î©ÎœÎ— -->
      <div class="financial-card pending">
        <h4>ğŸ“‹ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î Î¡ÎŸÎ£ Î Î›Î—Î¡Î©ÎœÎ—</h4>
        <div class="financial-amount" id="pendingPaymentDisplay">0.00 â‚¬</div>
        <div class="financial-details">
          <div><span>Î£ÏÎ½Î¿Î»Î¿ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½:</span> <span id="totalBudgetsAmount">0.00 â‚¬</span></div>
          <div><span>Î‰Î´Î· Î Î»Î·ÏÏ‰Î¼Î­Î½Î±:</span> <span id="alreadyPaidAmount">0.00 â‚¬</span></div>
        </div>
      </div>
      
      <!-- ÎšÎ‘Î¡Î¤Î‘ 3: Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î‘Î ÎŸ Î Î›Î—Î¡Î©ÎœÎ•Î£ Î•Î¦Î‘Î¡ÎœÎŸÎ“Î—Î£ -->
      <div class="financial-card app">
        <h4>ğŸ“± Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î‘Î ÎŸ Î Î›Î—Î¡Î©ÎœÎ•Î£ Î•Î¦Î‘Î¡ÎœÎŸÎ“Î—Î£</h4>
        <div class="financial-amount" id="appBalanceDisplay">0.00 â‚¬</div>
        <div class="financial-details">
          <div><span>Î‘ÏÏ‡Î¹ÎºÏŒ Î Î¿ÏƒÏŒ:</span> <span id="initialAppAmount">0.00 â‚¬</span></div>
          <div><span>ÎˆÏ‡Ï‰ Î¾Î¿Î´Î­ÏˆÎµÎ¹:</span> <span id="appSpentAmount">0.00 â‚¬</span></div>
          <div><span>Î‘Ï€Î¿Î¼Î­Î½Î¿Ï…Î½:</span> <span id="appRemainingAmount">0.00 â‚¬</span></div>
        </div>
        <div class="app-balance-input">
          <input type="number" id="initialAppBalanceInput" step="0.01" placeholder="Î’Î¬Î»Îµ Î±ÏÏ‡Î¹ÎºÏŒ Ï€Î¿ÏƒÏŒ">
          <button onclick="setInitialAppBalance()">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
        </div>
      </div>
    </div>

    <div style="margin-top: 20px;">
      <h3 style="color: #e91e63; margin-bottom: 10px;">ğŸ“‹ Î ÏÏŒÏƒÏ†Î±Ï„Î± Î­Î¾Î¿Î´Î±</h3>
      <div class="recent-expenses-container" id="recentExpenses"></div>
    </div>
  </div>

  <!-- TAB 2: Î¥Î ÎŸÎ›ÎŸÎ™Î Î‘ -->
  <div id="tab2" class="tab-content">
    <h2 style="color: #e91e63; margin-top: 0;">ğŸ“Š Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î±Î½Î¬ ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</h2>
    
    <!-- Î£Î¥Î£Î¤Î—ÎœÎ‘ ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î©Î -->
    <div class="transfer-system">
      <h4 style="margin-top: 0; color: #ff9800;">ğŸ”„ ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ Î Î¿ÏƒÏÎ½</h4>
      <p style="color: #666; font-size: 13px; margin-bottom: 15px;">ÎœÎµÏ„Î±Ï†Î­ÏÎµÏ„Îµ Ï€Î¿ÏƒÏŒ Î±Ï€ÏŒ Î¼Î¯Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± ÏƒÎµ Î¬Î»Î»Î· (Î® Î±Ï€ÏŒ/Ï€ÏÎ¿Ï‚ Î±Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·)</p>
      
      <div class="transfer-controls" style="display: grid; grid-template-columns: 1fr auto 1fr auto; gap: 10px; align-items: end; margin-bottom: 15px;">
        <!-- Î‘Î ÎŸ -->
        <div>
          <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Î‘Ï€ÏŒ:</label>
          <select id="transferFrom" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
            <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€Î·Î³Î®...</option>
            <option value="savings">ğŸ’° Î“ÎµÎ½Î¹ÎºÎ® Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·</option>
            <!-- Î˜Î± Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸Î¿ÏÎ½ Î¿Î¹ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Î¼Îµ JavaScript -->
          </select>
        </div>
        
        <!-- Î ÎŸÎ£ÎŸ -->
        <div>
          <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Î Î¿ÏƒÏŒ:</label>
          <div style="position: relative;">
            <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #ff9800; font-weight: bold;">â‚¬</span>
            <input type="number" id="transferAmount" step="0.01" placeholder="0.00" 
                   style="width: 120px; padding: 10px 10px 10px 30px; border-radius: 5px; border: 1px solid #ddd;">
          </div>
        </div>
        
        <!-- Î Î¡ÎŸÎ£ -->
        <div>
          <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">Î ÏÎ¿Ï‚:</label>
          <select id="transferTo" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
            <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒ...</option>
            <option value="savings">ğŸ’° Î“ÎµÎ½Î¹ÎºÎ® Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·</option>
            <!-- Î˜Î± Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸Î¿ÏÎ½ Î¿Î¹ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Î¼Îµ JavaScript -->
          </select>
        </div>
        
        <!-- ÎšÎŸÎ¥ÎœÎ Î™ -->
        <div>
          <button onclick="makeTransfer()" 
                  style="background: #ff9800; color: white; border: none; border-radius: 5px; padding: 10px 15px; cursor: pointer; height: 42px; width: 100%;">
            ğŸ”„ ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬
          </button>
        </div>
      </div>
      
      <div id="transferHistory" style="margin-top: 15px; max-height: 150px; overflow-y: auto; padding: 10px; background: rgba(255, 255, 255, 0.7); border-radius: 8px;">
        <!-- Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î¼ÎµÏ„Î±Ï†Î¿ÏÏÎ½ -->
      </div>
    </div>
    
    <div class="budget-cards" id="budgetCards"></div>
  </div>

  <!-- TAB 3: Î¤Î¡Î‘Î Î•Î–Î•Î£ -->
  <div id="tab3" class="tab-content">
    <h2 style="color: #e91e63; margin-top: 0;">ğŸ’° Î¤ÏÎ±Ï€ÎµÎ¶Î¹ÎºÎ¬ Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î±</h2>
    
    <div class="bank-cards">
      <div class="bank-card">
        <h4>ğŸ›ï¸ Î‘Î»Ï†Î± Î¤ÏÎ¬Ï€ÎµÎ¶Î±</h4>
        <input type="number" id="alphaBank" step="0.01" placeholder="0.00" style="text-align: center; font-size: 18px;" autocomplete="off">
      </div>
      
      <div class="bank-card">
        <h4>ğŸ‡¬ğŸ‡· Î•Î¸Î½Î¹ÎºÎ® Î¤ÏÎ¬Ï€ÎµÎ¶Î±</h4>
        <input type="number" id="nationalBank" step="0.01" placeholder="0.00" style="text-align: center; font-size: 18px;" autocomplete="off">
      </div>
      
      <div class="bank-card">
        <h4>ğŸ’µ ÎœÎµÏ„ÏÎ·Ï„Î¬</h4>
        <input type="number" id="cash" step="0.01" placeholder="0.00" style="text-align: center; font-size: 18px;" autocomplete="off">
      </div>
      
      <div class="bank-card">
        <h4>ğŸ“ˆ Î˜Î± Ï€Î¬ÏÏ‰ Î±ÎºÏŒÎ¼Î±</h4>
        <input type="number" id="expectedIncome" step="0.01" placeholder="0.00" style="text-align: center; font-size: 18px;" autocomplete="off">
      </div>
    </div>
    
    <button class="add" onclick="saveBankBalances()" style="margin-top: 20px; width: 100%;">
      <span>ğŸ’¾</span> Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î¥Ï€Î¿Î»Î¿Î¯Ï€Ï‰Î½
    </button>
  </div>

  <!-- TAB 4: Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ -->
  <div id="tab4" class="tab-content">
    <h2 style="color: #e91e63; margin-top: 0;">âš™ï¸ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚</h2>
    
    <div class="settings-section">
      <h3>ğŸ“‚ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹ÏÎ½</h3>
      <p style="color: #666; font-size: 13px; margin-bottom: 10px;">ğŸ¯ <strong>Î£ÏÏÏ„Îµ</strong> Ï„Î¹Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Î½Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ Ï„Î· ÏƒÎµÎ¹ÏÎ¬ Ï„Î¿Ï…Ï‚!</p>
      
      <div style="display: flex; gap: 10px; margin-bottom: 15px;">
        <input type="text" id="newCategoryName" placeholder="ÎŒÎ½Î¿Î¼Î± Î½Î­Î±Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚" style="flex: 1;" autocomplete="off">
        <button class="add" onclick="addNewCategory()" id="addCategoryButton" style="width: auto; padding: 12px 20px;">
          <span>â•</span> Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·
        </button>
      </div>
      
      <div class="categories-list" id="categoriesList"></div>
      <p style="color: #666; font-size: 13px; margin-top: 10px;">Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Î— Î´Î¹Î±Î³ÏÎ±Ï†Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚ Î¸Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ ÎºÎ±Î¹ Ï„Î± ÏƒÏ…Î½Î±Ï†Î® Î­Î¾Î¿Î´Î±!</p>
    </div>
    
    <div class="settings-section">
      <h3>ğŸ’° ÎœÎ·Î½Î¹Î±Î¯Î¿Î¹ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯</h3>
      <div id="recurringInputs"></div>
      <button class="add" onclick="saveRecurringAmounts()" style="margin-top: 15px; width: 100%;">
        <span>ğŸ’¾</span> Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½
      </button>
    </div>
    
    <div class="settings-section">
      <h3>ğŸ”— Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒÏ‚</h3>
      <div id="syncStatusInfo" style="margin-bottom: 15px;"></div>
      <button class="add" onclick="showSyncModal()" style="width: 100%;">
        <span>ğŸ”—</span> Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼Î¿Ï
      </button>
    </div>
  </div>

</div>

<!-- MODAL Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ¥ -->
<div class="modal" id="syncModal">
  <div class="modal-content">
    <h2 style="color: #e91e63; margin-top: 0;">ğŸ”— Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ£</h2>
    <div id="syncModalContent"></div>
    <div style="text-align: center; margin-top: 20px;">
      <button onclick="closeSyncModal()" style="padding: 10px 25px; background: #f0f0f0; border: none; border-radius: 8px; cursor: pointer;">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
    </div>
  </div>
</div>

<script>
// ==================== ÎŸÎ›Î•Î£ ÎŸÎ™ ÎœÎ•Î¤Î‘Î’Î›Î—Î¤Î•Î£ ====================
let categories = JSON.parse(localStorage.getItem('cats') || '[]');
let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
let recurringAmounts = JSON.parse(localStorage.getItem('recurringAmounts') || '{}');

let bankBalances = JSON.parse(localStorage.getItem('bankBalances') || JSON.stringify({
  alphaBank: 0,
  nationalBank: 0,
  cash: 0,
  expectedIncome: 0
}));

let appBalanceData = JSON.parse(localStorage.getItem('budgetbuddy_app_balance') || JSON.stringify({
  initialBalance: 0,
  spent: 0
}));

// ÎÎ•Î•Î£ ÎœÎ•Î¤Î‘Î’Î›Î—Î¤Î•Î£ Î“Î™Î‘ ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î•Î£ ÎšÎ‘Î™ Î‘Î ÎŸÎ¤Î‘ÎœÎ™Î•Î¥Î£Î—
let transfers = JSON.parse(localStorage.getItem('budgetbuddy_transfers') || '[]');
let savings = JSON.parse(localStorage.getItem('budgetbuddy_savings') || JSON.stringify({
  general: 0,
  totalAdded: 0,
  totalUsed: 0
}));

let syncData = JSON.parse(localStorage.getItem('budgetbuddy_sync') || '{}');
let currentUser = syncData.userName || "ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±";
let currentBudget = syncData.budgetCode || null;
let firebaseRef = null;

let currentMonth = localStorage.getItem('currentMonth') || new Date().toISOString().slice(0,7);

let draggedCategory = null;
let dragStartIndex = null;

let syncTimeout = null;
let isSyncing = false;

// ==================== Î”Î™ÎŸÎ¡Î˜Î©Î£Î— BUG - Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ Î£Î©Î£Î¤ÎŸÎ¥ SPENT ====================
function recalculateAppBalanceSpent() {
  // Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Ï„Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ Ï€Î¿ÏƒÏŒ Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Î¾Î¿Î´ÎµÏ…Ï„ÎµÎ¯ (Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï„Î¿Î½ Ï„ÏÎ­Ï‡Î¿Î½Ï„Î± Î¼Î®Î½Î±)
  const monthExpenses = expenses.filter(e => e.date.startsWith(currentMonth));
  const totalSpentThisMonth = monthExpenses.reduce((sum, e) => sum + e.amount, 0);
  
  // Î•Î½Î·Î¼ÎµÏÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ appBalanceData.spent
  appBalanceData.spent = totalSpentThisMonth;
  
  // Î‘Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Ï…Î¼Îµ
  localStorage.setItem('budgetbuddy_app_balance', JSON.stringify(appBalanceData));
}

// ==================== Î£Î¥Î£Î¤Î—ÎœÎ‘ ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î©Î ====================
function loadTransferUI() {
  const fromSelect = document.getElementById('transferFrom');
  const toSelect = document.getElementById('transferTo');
  
  // ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ (ÎºÏÎ±Ï„Î¬Î¼Îµ Î¼ÏŒÎ½Î¿ Ï„Î·Î½ Ï€ÏÏÏ„Î·)
  fromSelect.innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€Î·Î³Î®...</option><option value="savings">ğŸ’° Î“ÎµÎ½Î¹ÎºÎ® Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·</option>';
  toSelect.innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒ...</option><option value="savings">ğŸ’° Î“ÎµÎ½Î¹ÎºÎ® Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·</option>';
  
  // Î ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Ï…Î¼Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚
  categories.forEach(category => {
    const monthExpenses = expenses.filter(e => e.date.startsWith(currentMonth) && e.category === category);
    const categorySpent = monthExpenses.reduce((sum, e) => sum + e.amount, 0);
    const categoryBudget = recurringAmounts[category] || 0;
    
    // Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î©Î Î“Î™Î‘ Î¤Î—Î ÎšÎ‘Î¤Î—Î“ÎŸÎ¡Î™Î‘
    const transfersToCategory = transfers.filter(t => 
      t.month === currentMonth && t.to === category
    );
    const transfersFromCategory = transfers.filter(t => 
      t.month === currentMonth && t.from === category
    );
    
    const totalTransferredIn = transfersToCategory.reduce((sum, t) => sum + t.amount, 0);
    const totalTransferredOut = transfersFromCategory.reduce((sum, t) => sum + t.amount, 0);
    
    const adjustedBudget = categoryBudget + totalTransferredIn - totalTransferredOut;
    const remaining = adjustedBudget - categorySpent;
    
    // ÎœÏŒÎ½Î¿ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Î¼Îµ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ (>0) Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï€Î·Î³Î­Ï‚
    if (remaining > 0) {
      fromSelect.innerHTML += `<option value="${category}">${category} (Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î±: ${remaining.toFixed(2)}â‚¬)</option>`;
    }
    
    // ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯
    toSelect.innerHTML += `<option value="${category}">${category}</option>`;
  });
  
  updateTransferHistory();
}

function makeTransfer() {
  const from = document.getElementById('transferFrom').value;
  const to = document.getElementById('transferTo').value;
  const amountInput = document.getElementById('transferAmount');
  const amount = parseFloat(amountInput.value) || 0;
  
  // Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·
  if (!from || !to) {
    showQuickMessage('âš ï¸ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï€Î·Î³Î® ÎºÎ±Î¹ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒ', 'error');
    return;
  }
  
  if (from === to) {
    showQuickMessage('âš ï¸ Î— Ï€Î·Î³Î® ÎºÎ±Î¹ Î¿ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎ¯Î½Î±Î¹ Î¯Î´Î¹Î¿Î¹', 'error');
    return;
  }
  
  if (amount <= 0) {
    showQuickMessage('âš ï¸ Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ Î­Î³ÎºÏ…ÏÎ¿ Ï€Î¿ÏƒÏŒ', 'error');
    return;
  }
  
  // Î•Î›Î•Î“Î§ÎŸÎ™:
  if (from !== 'savings') {
    // ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ Î±Ï€ÏŒ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± - ÎµÎ»Î­Î³Ï‡Î¿Ï…Î¼Îµ Î±Î½ Î­Ï‡ÎµÎ¹ Î±ÏÎºÎµÏ„ÏŒ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿
    const monthExpenses = expenses.filter(e => e.date.startsWith(currentMonth) && e.category === from);
    const categorySpent = monthExpenses.reduce((sum, e) => sum + e.amount, 0);
    const categoryBudget = recurringAmounts[from] || 0;
    
    // Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î©Î Î“Î™Î‘ Î¤Î—Î ÎšÎ‘Î¤Î—Î“ÎŸÎ¡Î™Î‘
    const transfersToCategory = transfers.filter(t => 
      t.month === currentMonth && t.to === from
    );
    const transfersFromCategory = transfers.filter(t => 
      t.month === currentMonth && t.from === from
    );
    
    const totalTransferredIn = transfersToCategory.reduce((sum, t) => sum + t.amount, 0);
    const totalTransferredOut = transfersFromCategory.reduce((sum, t) => sum + t.amount, 0);
    
    const adjustedBudget = categoryBudget + totalTransferredIn - totalTransferredOut;
    const remaining = adjustedBudget - categorySpent;
    
    if (amount > remaining) {
      showQuickMessage(`âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±ÏÎºÎµÏ„Î¬ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± (ÎˆÏ‡ÎµÎ¹Ï‚: ${remaining.toFixed(2)}â‚¬)`, 'error');
      return;
    }
  } else {
    // ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ Î±Ï€ÏŒ Î±Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ· - ÎµÎ»Î­Î³Ï‡Î¿Ï…Î¼Îµ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿
    if (amount > savings.general) {
      showQuickMessage(`âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î±ÏÎºÎµÏ„Î® Î±Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ· (ÎˆÏ‡ÎµÎ¹Ï‚: ${savings.general.toFixed(2)}â‚¬)`, 'error');
      return;
    }
  }
  
  // ÎšÎ‘Î¤Î‘Î§Î©Î¡Î—Î£Î— ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î‘Î£
  const transfer = {
    id: Date.now(),
    from: from,
    to: to,
    amount: amount,
    month: currentMonth,
    date: new Date().toISOString().slice(0,10),
    timestamp: Date.now()
  };
  
  transfers.push(transfer);
  localStorage.setItem('budgetbuddy_transfers', JSON.stringify(transfers));
  
  // Î•ÎÎ—ÎœÎ•Î¡Î©Î£Î— Î‘Î ÎŸÎ¤Î‘ÎœÎ™Î•Î¥Î£Î—Î£
  if (from === 'savings') {
    savings.general -= amount;
    savings.totalUsed += amount;
  }
  
  if (to === 'savings') {
    savings.general += amount;
    savings.totalAdded += amount;
  }
  
  localStorage.setItem('budgetbuddy_savings', JSON.stringify(savings));
  
  // Reset
  amountInput.value = '';
  
  saveAllData();
  updateBudgetOverview();
  updateFinancialOverview();
  loadTransferUI(); // Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· Ï„Ï‰Î½ dropdowns
  
  showQuickMessage(`âœ… ÎœÎµÏ„Î±Ï†Î­ÏÎ¸Î·ÎºÎ±Î½ ${amount.toFixed(2)}â‚¬ Î±Ï€ÏŒ ${getTransferLabel(from)} Ï€ÏÎ¿Ï‚ ${getTransferLabel(to)}`, 'success');
}

function getTransferLabel(value) {
  if (value === 'savings') return 'ğŸ’° Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·';
  return value;
}

function updateTransferHistory() {
  const container = document.getElementById('transferHistory');
  const monthTransfers = transfers.filter(t => t.month === currentMonth);
  
  if (monthTransfers.length === 0) {
    container.innerHTML = `
      <div style="text-align: center; padding: 10px; color: #777; font-size: 13px;">
        ğŸ“­ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ­Ï‚ Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Î¼Î®Î½Î±
      </div>
    `;
    return;
  }
  
  let html = `
    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
      <strong>Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÎœÎµÏ„Î±Ï†Î¿ÏÏÎ½</strong> (${monthTransfers.length})
    </div>
  `;
  
  // Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· Î±Ï€ÏŒ Î½ÎµÏŒÏ„ÎµÏÎ¿ Ï€ÏÎ¿Ï‚ Ï€Î±Î»Î¹ÏŒÏ„ÎµÏÎ¿
  monthTransfers.sort((a, b) => b.timestamp - a.timestamp);
  
  monthTransfers.forEach(transfer => {
    html += `
      <div class="transfer-history-item">
        <div>
          <div style="font-weight: bold; font-size: 12px;">
            ${getTransferLabel(transfer.from)} â†’ ${getTransferLabel(transfer.to)}
          </div>
          <div style="font-size: 11px; color: #999;">${transfer.date}</div>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="color: #ff9800; font-weight: bold;">${transfer.amount.toFixed(2)}â‚¬</span>
          <button onclick="deleteTransfer(${transfer.id})" 
                  style="background: #ffcdd2; color: #c62828; border: none; border-radius: 3px; padding: 2px 6px; font-size: 10px; cursor: pointer; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
            Ã—
          </button>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function deleteTransfer(transferId) {
  if (!confirm('Î”Î¹Î±Î³ÏÎ±Ï†Î® Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚; Î˜Î± ÎµÏ€Î±Î½Î­Î»Î¸Î¿Ï…Î½ Ï„Î± Ï€Î¿ÏƒÎ¬ ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Ï„Î¿Ï…Ï‚ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·!')) {
    return;
  }
  
  const transferIndex = transfers.findIndex(t => t.id === transferId);
  if (transferIndex !== -1) {
    const transfer = transfers[transferIndex];
    
    // Î‘ÎÎ¤Î™Î£Î¤Î¡ÎŸÎ¦Î— Î¤Î—Î£ ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î‘Î£
    if (transfer.from === 'savings') {
      savings.general += transfer.amount; // Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·
      savings.totalUsed -= transfer.amount;
    }
    
    if (transfer.to === 'savings') {
      savings.general -= transfer.amount; // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Î±Ï€ÏŒ Ï„Î·Î½ Î±Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·
      savings.totalAdded -= transfer.amount;
    }
    
    // Î”Î¹Î±Î³ÏÎ±Ï†Î®
    transfers.splice(transferIndex, 1);
    
    localStorage.setItem('budgetbuddy_transfers', JSON.stringify(transfers));
    localStorage.setItem('budgetbuddy_savings', JSON.stringify(savings));
    
    saveAllData();
    updateBudgetOverview();
    updateFinancialOverview();
    loadTransferUI();
    
    showQuickMessage(`ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬ ${transfer.amount.toFixed(2)}â‚¬`, 'success');
  }
}

// ==================== Î’Î•Î›Î¤Î™Î©ÎœÎ•ÎÎŸÎ£ Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ£ ====================
function updateSyncUI(status, data = null) {
  const mainDot = document.getElementById('mainSyncDot');
  const buttonText = document.getElementById('syncButtonText');
  const syncInfo = document.getElementById('syncStatusInfo');
  
  if (status === 'online' && data) {
    mainDot.className = 'sync-status-dot sync-online';
    buttonText.textContent = `Î£Ï…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿`;
    
    if (syncInfo) {
      syncInfo.innerHTML = `
        <div style="background: #e8f5e9; padding: 10px; border-radius: 8px;">
          <strong>âœ… Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼Î­Î½Î¿!</strong><br>
          <small>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚: <strong>${currentBudget}</strong></small>
        </div>
      `;
    }
    
  } else if (status === 'connecting') {
    mainDot.className = 'sync-status-dot sync-connecting';
    buttonText.textContent = 'Î£Ï…Î½Î´Î­ÎµÏ„Î±Î¹...';
    
    if (syncInfo) {
      syncInfo.innerHTML = '<div style="color: #ff9800;">ğŸ”„ Î£ÏÎ½Î´ÎµÏƒÎ· ÏƒÎµ cloud...</div>';
    }
    
  } else {
    mainDot.className = 'sync-status-dot sync-offline';
    buttonText.textContent = 'Î£Ï…Î½Î´Î­ÏƒÎ¿Ï…';
    
    if (syncInfo) {
      syncInfo.innerHTML = '<div style="color: #666;">ğŸ”Œ Î§Ï‰ÏÎ¯Ï‚ ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ</div>';
    }
  }
}

function initSync() {
  if (!currentBudget) {
    updateSyncUI('offline');
    return;
  }
  
  if (firebase.apps.length === 0) {
    try {
      const firebaseConfig = {
        apiKey: "AIzaSyBaItM0-eOAwU6snAxfMU_bcp9xW0UfYzQ",
        authDomain: "travelcosts-48d64.firebaseapp.com",
        databaseURL: "https://travelcosts-48d64-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "travelcosts-48d64",
        storageBucket: "travelcosts-48d64.firebasestorage.app",
        messagingSenderId: "792639383940",
        appId: "1:792639383940:web:ed991cc8426603015bd5d1"
      };
      firebase.initializeApp(firebaseConfig);
    } catch (error) {
      console.warn("Firebase init error:", error);
      updateSyncUI('offline');
      return;
    }
  }
  
  const database = firebase.database();
  firebaseRef = database.ref(`budgets/${currentBudget}`);
  
  updateSyncUI('connecting');
  
  firebaseRef.once('value')
    .then((snapshot) => {
      const data = snapshot.val();
      if (data) {
        if (data.categories && data.categories.length > 0 && categories.length === 0) {
          categories = data.categories;
        }
        
        if (data.expenses && data.expenses.length > 0 && expenses.length === 0) {
          expenses = data.expenses;
        }
        
        if (data.recurringAmounts && Object.keys(recurringAmounts).length === 0) {
          recurringAmounts = data.recurringAmounts;
        }
        
        if (data.bankBalances && Object.keys(bankBalances).length === 4) {
          bankBalances = data.bankBalances;
        }
        
        if (data.appBalanceData && Object.keys(appBalanceData).length === 2) {
          appBalanceData = data.appBalanceData;
          localStorage.setItem('budgetbuddy_app_balance', JSON.stringify(appBalanceData));
        }
        
        // ÎÎ•ÎŸ: Î£Ï…Î³ÎºÏÎ¯Î½Î¿Ï…Î¼Îµ ÎºÎ±Î¹ Ï„Î± Î½Î­Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
        if (data.transfers) {
          transfers = data.transfers;
          localStorage.setItem('budgetbuddy_transfers', JSON.stringify(transfers));
        }
        
        if (data.savings) {
          savings = data.savings;
          localStorage.setItem('budgetbuddy_savings', JSON.stringify(savings));
        }
        
        syncData.budgetName = data.name || syncData.budgetName;
        syncData.creator = data.creator || syncData.creator;
        syncData.members = data.members || [currentUser];
        
        localStorage.setItem('budgetbuddy_sync', JSON.stringify(syncData));
        saveAllData();
        updateUIFromData();
        updateSyncUI('online', data);
        
        setupFirebaseListeners();
        
      } else {
        createNewBudgetInFirebase();
      }
    })
    .catch((error) => {
      console.warn("Firebase connection error:", error);
      updateSyncUI('offline');
    });
}

function setupFirebaseListeners() {
  if (!firebaseRef) return;
  
  firebaseRef.on('value', (snapshot) => {
    const data = snapshot.val();
    if (data && !isSyncing) {
      updateUIFromSync(data);
    }
  }, (error) => {
    console.warn("Firebase listener error:", error);
  });
}

function updateUIFromSync(data) {
  const localHash = JSON.stringify(expenses).length + JSON.stringify(categories).length;
  const remoteHash = JSON.stringify(data.expenses || []).length + JSON.stringify(data.categories || []).length;
  
  if (Math.abs(localHash - remoteHash) > 100) {
    if (data.categories && data.categories.length > categories.length) {
      categories = [...new Set([...categories, ...data.categories])];
    }
    
    if (data.expenses) {
      const newExpenses = data.expenses.filter(remoteExp => 
        !expenses.some(localExp => localExp.id === remoteExp.id)
      );
      if (newExpenses.length > 0) {
        expenses = [...expenses, ...newExpenses];
      }
    }
    
    if (data.appBalanceData) {
      appBalanceData = data.appBalanceData;
      localStorage.setItem('budgetbuddy_app_balance', JSON.stringify(appBalanceData));
    }
    
    // ÎÎ•ÎŸ: Î£Ï…Î³ÎºÏÎ¯Î½Î¿Ï…Î¼Îµ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ­Ï‚ ÎºÎ±Î¹ Î±Ï€Î¿Ï„Î±Î¼Î¹ÎµÏÏƒÎµÎ¹Ï‚
    if (data.transfers) {
      const newTransfers = data.transfers.filter(remote => 
        !transfers.some(local => local.id === remote.id)
      );
      if (newTransfers.length > 0) {
        transfers = [...transfers, ...newTransfers];
        localStorage.setItem('budgetbuddy_transfers', JSON.stringify(transfers));
      }
    }
    
    if (data.savings) {
      savings = data.savings;
      localStorage.setItem('budgetbuddy_savings', JSON.stringify(savings));
    }
    
    saveAllData();
    updateUIFromData();
  }
}

function debouncedSync() {
  if (!currentBudget || isSyncing) return;
  
  if (syncTimeout) {
    clearTimeout(syncTimeout);
  }
  
  syncTimeout = setTimeout(() => {
    syncToFirebase();
  }, 2000);
}

function syncToFirebase() {
  if (!currentBudget || !firebaseRef || isSyncing) return;
  
  isSyncing = true;
  
  const budgetData = {
    code: currentBudget,
    name: syncData.budgetName || `Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ${currentBudget}`,
    creator: syncData.creator || currentUser,
    members: syncData.members || [currentUser],
    categories: categories,
    expenses: expenses.slice(-100),
    recurringAmounts: recurringAmounts,
    bankBalances: bankBalances,
    appBalanceData: appBalanceData,
    transfers: transfers,
    savings: savings,
    lastUpdated: Date.now()
  };
  
  firebaseRef.set(budgetData)
    .then(() => {
      isSyncing = false;
    })
    .catch((error) => {
      console.warn("Sync error:", error);
      isSyncing = false;
      updateSyncUI('offline');
    });
}

function createNewBudgetInFirebase() {
  if (!currentBudget || !firebaseRef) return;
  
  const budgetName = syncData.budgetName || `Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ${currentBudget}`;
  
  const newBudget = {
    code: currentBudget,
    name: budgetName,
    creator: currentUser,
    created: Date.now(),
    members: [currentUser],
    categories: categories.length > 0 ? categories : ['Î£Î¿ÏÏ€ÎµÏ ÎœÎ¬ÏÎºÎµÏ„', 'ÎÎ¿Î¯ÎºÎ¹', 'Î—Î»ÎµÎºÏ„ÏÎ¹ÎºÏŒ', 'ÎÎµÏÏŒ', 'Î¤Î·Î»Î­Ï†Ï‰Î½Î±', 'ÎšÎ±ÏÏƒÎ¹Î¼Î±', 'Î¨Ï…Ï‡Î±Î³Ï‰Î³Î¯Î±'],
    expenses: expenses,
    recurringAmounts: recurringAmounts,
    bankBalances: bankBalances,
    appBalanceData: appBalanceData,
    transfers: transfers,
    savings: savings,
    lastUpdated: Date.now()
  };
  
  firebaseRef.set(newBudget)
    .then(() => {
      updateSyncUI('online', newBudget);
      setupFirebaseListeners();
    })
    .catch(error => {
      console.warn("Firebase create error:", error);
      updateSyncUI('offline');
    });
}

// ==================== ÎÎ•Î•Î£ Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î•Î£ ====================

// 1. Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î‘Î›Î›Î‘Î“Î—Î£ ÎœÎ—ÎÎ‘
function initMonthSelector() {
  const monthSelect = document.getElementById('monthSelect');
  const now = new Date();
  let html = '';
  
  for (let i = -6; i <= 5; i++) {
    const date = new Date(now.getFullYear(), now.getMonth() + i, 1);
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const monthKey = `${year}-${month.toString().padStart(2, '0')}`;
    const monthName = date.toLocaleDateString('el-GR', { month: 'long', year: 'numeric' });
    const isSelected = monthKey === currentMonth;
    
    html += `<option value="${monthKey}" ${isSelected ? 'selected' : ''}>${monthName.charAt(0).toUpperCase() + monthName.slice(1)}</option>`;
  }
  
  monthSelect.innerHTML = html;
  
  monthSelect.addEventListener('change', function() {
    const selectedMonth = this.value;
    if (selectedMonth !== currentMonth) {
      if (confirm(`ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬ ÏƒÏ„Î¿Î½ Î¼Î®Î½Î±: ${selectedMonth}\nÎŸÎ¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯ Ï€Î±ÏÎ±Î¼Î­Î½Î¿Ï…Î½, Ï„Î± Î­Î¾Î¿Î´Î± Î¸Î± Ï†Î±Î¯Î½Î¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï„Î¿Î½ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Î¼Î®Î½Î±.`)) {
        currentMonth = selectedMonth;
        localStorage.setItem('currentMonth', currentMonth);
        
        updateRecentExpenses();
        updateBudgetOverview();
        updateFinancialOverview();
        loadTransferUI();
        
        showQuickMessage(`ğŸ“… Î‘Î»Î»Î±Î³Î® ÏƒÎµ Î¼Î®Î½Î±: ${selectedMonth}`, 'success');
      } else {
        this.value = currentMonth;
      }
    }
  });
}

function resetCurrentMonth() {
  if (confirm(`Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ ÏŒÎ»Î± Ï„Î± Î­Î¾Î¿Î´Î± Î³Î¹Î± Ï„Î¿Î½ Î¼Î®Î½Î± ${currentMonth};\n\nâš ï¸ Î— ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î±Ï…Ï„Î® Î”Î•Î Î•Î™ÎÎ‘Î™ Î‘ÎÎ‘Î£Î¤Î¡Î•Î Î¤Î—!\nÎŸÎ¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯ ÎºÎ±Î¹ Î¿Î¹ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ Ï€Î±ÏÎ±Î¼Î­Î½Î¿Ï…Î½.`)) {
    const expensesToKeep = expenses.filter(expense => !expense.date.startsWith(currentMonth));
    expenses = expensesToKeep;
    
    // Î”Î¹Î±Î³ÏÎ±Ï†Î® Î¼ÎµÏ„Î±Ï†Î¿ÏÏÎ½ Ï„Î¿Ï… Î¼Î®Î½Î±
    transfers = transfers.filter(t => t.month !== currentMonth);
    localStorage.setItem('budgetbuddy_transfers', JSON.stringify(transfers));
    
    saveAllData();
    updateRecentExpenses();
    updateBudgetOverview();
    updateFinancialOverview();
    loadTransferUI();
    showQuickMessage(`ğŸ§¹ Î•ÎºÎºÎ±Î¸Î¬ÏÎ¹ÏƒÎ· Î¼Î®Î½Î± ${currentMonth} Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ!`, 'success');
  }
}

function createNewMonth() {
  const now = new Date();
  const nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
  const year = nextMonth.getFullYear();
  const month = nextMonth.getMonth() + 1;
  const monthKey = `${year}-${month.toString().padStart(2, '0')}`;
  const monthName = nextMonth.toLocaleDateString('el-GR', { month: 'long', year: 'numeric' });
  
  if (confirm(`Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… Î¼Î®Î½Î±: ${monthName};\n\nâœ… Î˜Î± Î¼ÎµÏ„Î±Ï†ÎµÏÎ¸Î¿ÏÎ½ Î¿Î¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯\nâœ… Î˜Î± Î´Î¹Î±Ï„Î·ÏÎ·Î¸Î¿ÏÎ½ Î¿Î¹ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚\nâœ… Î¤Î± Î­Î¾Î¿Î´Î± Î¸Î± Ï†Î±Î¯Î½Î¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï„Î¿Î½ Î½Î­Î¿ Î¼Î®Î½Î±`)) {
    currentMonth = monthKey;
    localStorage.setItem('currentMonth', currentMonth);
    
    const monthSelect = document.getElementById('monthSelect');
    const optionExists = Array.from(monthSelect.options).some(opt => opt.value === monthKey);
    
    if (!optionExists) {
      const newOption = new Option(monthName.charAt(0).toUpperCase() + monthName.slice(1), monthKey);
      monthSelect.appendChild(newOption);
    }
    
    monthSelect.value = monthKey;
    
    showQuickMessage(`âœ… Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… Î¼Î®Î½Î±: ${monthName}`, 'success');
    
    updateRecentExpenses();
    updateBudgetOverview();
    updateFinancialOverview();
    loadTransferUI();
  }
}

// 2. ÎŸÎ™ 3 ÎšÎ‘Î™ÎÎŸÎ¥Î¡Î“Î™Î•Î£ ÎšÎ‘Î¡Î¤Î•Î£ Î£Î¤Î—Î ÎšÎ‘Î¡Î¤Î•Î›Î‘ 1
function updateFinancialOverview() {
  // 1. Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î§Î•Î™Î¡ÎŸÎšÎ™ÎÎ—Î¤Î‘: Î†Î¸ÏÎ¿Î¹ÏƒÎ¼Î± ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï€Î·Î³ÏÎ½
  const totalManual = (bankBalances.alphaBank || 0) + 
                     (bankBalances.nationalBank || 0) + 
                     (bankBalances.cash || 0) + 
                     (bankBalances.expectedIncome || 0);
  
  document.getElementById('totalManualDisplay').textContent = totalManual.toFixed(2) + ' â‚¬';
  document.getElementById('alphaAmount').textContent = (bankBalances.alphaBank || 0).toFixed(2) + ' â‚¬';
  document.getElementById('nationalAmount').textContent = (bankBalances.nationalBank || 0).toFixed(2) + ' â‚¬';
  document.getElementById('cashAmount').textContent = (bankBalances.cash || 0).toFixed(2) + ' â‚¬';
  document.getElementById('expectedAmount').textContent = (bankBalances.expectedIncome || 0).toFixed(2) + ' â‚¬';
  
  // 2. Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î Î¡ÎŸÎ£ Î Î›Î—Î¡Î©ÎœÎ—: (Î£ÏÎ½Î¿Î»Î¿ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½) - (Î‰Î´Î· Ï€Î»Î·ÏÏ‰Î¼Î­Î½Î±)
  let totalBudgets = 0;
  categories.forEach(category => {
    totalBudgets += recurringAmounts[category] || 0;
  });
  
  const monthExpenses = expenses.filter(e => e.date.startsWith(currentMonth));
  const alreadyPaid = monthExpenses.reduce((sum, e) => sum + e.amount, 0);
  
  const pendingPayment = totalBudgets - alreadyPaid;
  
  document.getElementById('pendingPaymentDisplay').textContent = pendingPayment.toFixed(2) + ' â‚¬';
  document.getElementById('totalBudgetsAmount').textContent = totalBudgets.toFixed(2) + ' â‚¬';
  document.getElementById('alreadyPaidAmount').textContent = alreadyPaid.toFixed(2) + ' â‚¬';
  
  // 3. Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î‘Î ÎŸ Î Î›Î—Î¡Î©ÎœÎ•Î£ Î•Î¦Î‘Î¡ÎœÎŸÎ“Î—Î£
  const initialAppBalance = appBalanceData.initialBalance || 0;
  const appSpent = appBalanceData.spent || 0;
  const appRemaining = initialAppBalance - appSpent;
  
  document.getElementById('appBalanceDisplay').textContent = appRemaining.toFixed(2) + ' â‚¬';
  document.getElementById('initialAppAmount').textContent = initialAppBalance.toFixed(2) + ' â‚¬';
  document.getElementById('appSpentAmount').textContent = appSpent.toFixed(2) + ' â‚¬';
  document.getElementById('appRemainingAmount').textContent = appRemaining.toFixed(2) + ' â‚¬';
  
  // Î§ÏÏÎ¼Î±Ï„Î± Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î·Î½ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·
  const pendingElement = document.getElementById('pendingPaymentDisplay');
  const appElement = document.getElementById('appBalanceDisplay');
  
  if (pendingPayment < 0) {
    pendingElement.style.color = '#f44336';
  } else if (pendingPayment === 0) {
    pendingElement.style.color = '#ff9800';
  } else {
    pendingElement.style.color = '#4caf50';
  }
  
  if (appRemaining < 0) {
    appElement.style.color = '#f44336';
  } else if (appRemaining < initialAppBalance * 0.1) {
    appElement.style.color = '#ff9800';
  } else {
    appElement.style.color = '#9c27b0';
  }
}

// 3. Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î•Î£ Î“Î™Î‘ Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î‘Î ÎŸ Î Î›Î—Î¡Î©ÎœÎ•Î£ Î•Î¦Î‘Î¡ÎœÎŸÎ“Î—Î£
function setInitialAppBalance() {
  const input = document.getElementById('initialAppBalanceInput');
  const amount = parseFloat(input.value) || 0;
  
  if (amount < 0) {
    showQuickMessage('âš ï¸ Î¤Î¿ Ï€Î¿ÏƒÏŒ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Î±ÏÎ½Î·Ï„Î¹ÎºÏŒ', 'error');
    return;
  }
  
  // Î‘Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Ï…Î¼Îµ Ï„Î¿ Î½Î­Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Ï€Î¿ÏƒÏŒ
  appBalanceData.initialBalance = amount;
  
  // Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Î¾Î±Î½Î¬ Ï„Î± Î­Î¾Î¿Î´Î±
  recalculateAppBalanceSpent();
  
  // Î£Ï…Î³Ï‡ÏÎ¿Î½Î¯Î¶Î¿Ï…Î¼Îµ Î¼Îµ Firebase
  debouncedSync();
  
  updateFinancialOverview();
  
  input.value = '';
  showQuickMessage(`âœ… ÎŸÏÎ¯ÏƒÏ„Î·ÎºÎµ Î±ÏÏ‡Î¹ÎºÏŒ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï€Î¿ÏƒÏŒ: ${amount.toFixed(2)}â‚¬`, 'success');
}

function resetAppBalance() {
  if (confirm('Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î¼Î·Î´ÎµÎ½Î¯ÏƒÎµÏ„Îµ Ï„Î¿ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚;\nÎ˜Î± Î´Î¹Î±Î³ÏÎ±Ï†ÎµÎ¯ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Ï€Î¿ÏƒÏŒ ÎºÎ±Î¹ ÏŒÎ»Î± Ï„Î± Î­Î¾Î¿Î´Î±.')) {
    appBalanceData = {
      initialBalance: 0,
      spent: 0
    };
    
    localStorage.setItem('budgetbuddy_app_balance', JSON.stringify(appBalanceData));
    debouncedSync();
    updateFinancialOverview();
    showQuickMessage('ğŸ§¹ ÎœÎ·Î´ÎµÎ½Î¯ÏƒÏ„Î·ÎºÎµ Ï„Î¿ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚', 'success');
  }
}

// ==================== Î’Î‘Î£Î™ÎšÎ•Î£ Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î•Î£ ====================
function switchTab(tabNumber) {
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  document.querySelector(`.tab:nth-child(${tabNumber})`).classList.add('active');
  document.getElementById(`tab${tabNumber}`).classList.add('active');
  
  if (tabNumber === 1) {
    updateFinancialOverview();
  }
  
  if (tabNumber === 2) {
    updateBudgetOverview();
    loadTransferUI();
  }
  
  if (tabNumber === 3) {
    loadBankValues();
  }
  
  if (tabNumber === 4) {
    updateCategoriesList();
    updateRecurringInputs();
  }
}

function showQuickMessage(message, type = 'info') {
  const msg = document.createElement('div');
  msg.style.cssText = `
    position: fixed;
    top: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4caf50' : '#333'};
    color: white;
    padding: 12px 24px;
    border-radius: 25px;
    z-index: 10000;
    font-size: 14px;
    animation: fadeInOut 3s ease-in-out;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 10px;
  `;
  msg.innerHTML = `
    ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}
    <span>${message}</span>
  `;
  
  document.body.appendChild(msg);
  
  setTimeout(() => {
    msg.style.animation = 'fadeOut 0.5s ease-in-out';
    setTimeout(() => msg.remove(), 500);
  }, 3000);
}

if (!document.getElementById('msg-styles')) {
  const style = document.createElement('style');
  style.id = 'msg-styles';
  style.textContent = `
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
      10% { opacity: 1; transform: translateX(-50%) translateY(0); }
      90% { opacity: 1; transform: translateX(-50%) translateY(0); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  `;
  document.head.appendChild(style);
}

// ==================== MODAL Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ¥ ====================
function showSyncModal() {
  const modal = document.getElementById('syncModal');
  const content = document.getElementById('syncModalContent');
  
  if (currentBudget) {
    content.innerHTML = `
      <div style="margin-bottom: 20px;">
        <h3>âœ… Î•Î¯ÏƒÏ„Îµ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Î¹!</h3>
        <p><strong>Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚:</strong> ${syncData.budgetName || currentBudget}</p>
        <p><strong>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚:</strong></p>
        <div style="text-align: center; margin: 15px 0;">
          <div style="font-size: 32px; font-weight: bold; letter-spacing: 3px; color: #e91e63; background: #f9f9f9; padding: 15px; border-radius: 10px;">
            ${currentBudget}
          </div>
        </div>
        <p><small>Î”ÏÏƒÏ„Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ ÏƒÏ„Î¿Î½ ÏƒÏÎ¶Ï…Î³Î¿/ÏƒÏÎ¶Ï…Î³Î¿ Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯</small></p>
      </div>
      
      <div style="display: grid; gap: 10px;">
        <button onclick="showQRCode()" style="padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer;">
          ğŸ´ Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· QR Code
        </button>
        <button onclick="copySyncCode()" style="padding: 12px; background: #2196f3; color: white; border: none; border-radius: 8px; cursor: pointer;">
          ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î® ÎšÏ‰Î´Î¹ÎºÎ¿Ï
        </button>
        <button onclick="disconnectSync()" style="padding: 12px; background: #f44336; color: white; border: none; border-radius: 8px; cursor: pointer;">
          ğŸ”Œ Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·
        </button>
      </div>
    `;
  } else {
    content.innerHTML = `
      <div style="margin-bottom: 20px;">
        <h3>ğŸ”— Î£Ï…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï</h3>
        <p>Î£Ï…Î½Î´Î­ÏƒÏ„Îµ 2 Î® Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± ÎºÎ¹Î½Î·Ï„Î¬ Î³Î¹Î± Î½Î± Î­Ï‡ÎµÏ„Îµ Ï„Î± Î¯Î´Î¹Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿!</p>
      </div>
      
      <div style="margin-bottom: 20px;">
        <h4>ğŸš€ Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ ÎÎ•ÎŸÎ¥</h4>
        
        <div style="margin: 10px 0;">
          <label style="display: block; margin-bottom: 5px;">Î¤Î¿ ÎŒÎ½Î¿Î¼Î¬ Î£Î±Ï‚:</label>
          <input type="text" id="newUserName" value="${currentUser}" placeholder="Ï€.Ï‡. ÎœÎ±ÏÎ¯Î±" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        </div>
        
        <div style="margin: 10px 0;">
          <label style="display: block; margin-bottom: 5px;">ÎŒÎ½Î¿Î¼Î± Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï:</label>
          <input type="text" id="newBudgetName" placeholder="Ï€.Ï‡. ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± Î™Î±Î½Î¿Ï…Î¬ÏÎ¹Î¿Ï‚" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        </div>
        
        <button onclick="createNewSync()" style="width: 100%; padding: 12px; background: #e91e63; color: white; border: none; border-radius: 8px; cursor: pointer;">
          ğŸš€ Î”Î—ÎœÎ™ÎŸÎ¥Î¡Î“Î™Î‘ ÎÎ•ÎŸÎ¥ Î Î¡ÎŸÎ¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ¥
        </button>
      </div>
      
      <div>
        <h4>ğŸ”— Î£Î¥ÎÎ”Î•Î£Î— Î£Î• Î¥Î Î‘Î¡Î§ÎŸÎ</h4>
        
        <div style="margin: 10px 0;">
          <label style="display: block; margin-bottom: 5px;">Î¤Î¿ ÎŒÎ½Î¿Î¼Î¬ Î£Î±Ï‚:</label>
          <input type="text" id="joinUserName" value="${currentUser}" placeholder="Ï€.Ï‡. Î“Î¹Î¬Î½Î½Î·Ï‚" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        </div>
        
        <div style="margin: 10px 0;">
          <label style="display: block; margin-bottom: 5px;">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï:</label>
          <input type="text" id="joinBudgetCode" placeholder="6 ÏˆÎ·Ï†Î¯Î±" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; text-align: center; letter-spacing: 3px; font-size: 18px;">
        </div>
        
        <button onclick="joinExistingSync()" style="width: 100%; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer;">
          ğŸ”— Î£Î¥ÎÎ”Î•Î£Î— Î£Î• Î¥Î Î‘Î¡Î§ÎŸÎ Î Î¡ÎŸÎ¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸ
        </button>
      </div>
    `;
  }
  
  modal.style.display = 'flex';
}

function closeSyncModal() {
  document.getElementById('syncModal').style.display = 'none';
}

function createNewSync() {
  const userName = document.getElementById('newUserName').value.trim() || "ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±";
  const budgetName = document.getElementById('newBudgetName').value.trim() || "ÎŸÎ¹ÎºÎ¿Î³ÎµÎ½ÎµÎ¹Î±ÎºÏŒÏ‚ Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚";
  
  if (!budgetName) {
    showQuickMessage('âš ï¸ Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ½Î¿Î¼Î± Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï', 'error');
    return;
  }
  
  currentUser = userName;
  currentBudget = generateSyncCode();
  
  syncData = {
    userName: userName,
    budgetCode: currentBudget,
    budgetName: budgetName,
    creator: userName,
    members: [userName],
    justCreated: true
  };
  
  localStorage.setItem('budgetbuddy_sync', JSON.stringify(syncData));
  
  closeSyncModal();
  showQuickMessage('âœ… Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î½Î­Î¿Ï‚ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚!', 'success');
  
  setTimeout(() => {
    initSync();
  }, 500);
}

function joinExistingSync() {
  const userName = document.getElementById('joinUserName').value.trim() || "ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î±";
  const joinCode = document.getElementById('joinBudgetCode').value.trim().toUpperCase();
  
  if (!joinCode || joinCode.length !== 6) {
    showQuickMessage('âš ï¸ Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ 6-ÏˆÎ®Ï†Î¹Î¿ ÎºÏ‰Î´Î¹ÎºÏŒ', 'error');
    return;
  }
  
  currentUser = userName;
  currentBudget = joinCode;
  
  syncData = {
    userName: userName,
    budgetCode: joinCode,
    members: [userName]
  };
  
  localStorage.setItem('budgetbuddy_sync', JSON.stringify(syncData));
  
  closeSyncModal();
  showQuickMessage('ğŸ”— Î£Ï…Î½Î´Î­ÎµÏƒÏ„Îµ ÏƒÏ„Î¿Î½ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ...', 'info');
  
  setTimeout(() => {
    initSync();
  }, 500);
}

function showQRCode() {
  if (!currentBudget) return;
  
  const qrData = {
    app: "BudgetBuddy",
    code: currentBudget,
    name: syncData.budgetName || "Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚",
    type: "join"
  };
  
  const qrText = JSON.stringify(qrData);
  
  QRCode.toCanvas(qrText, { width: 250 }, function(error, canvas) {
    if (error) {
      console.error('QR error:', error);
      return;
    }
    
    const modal = document.getElementById('syncModal');
    const content = document.getElementById('syncModalContent');
    
    content.innerHTML = `
      <div style="text-align: center;">
        <h3>ğŸ“± QR Code Î£ÏÎ½Î´ÎµÏƒÎ·Ï‚</h3>
        <p>Î£ÎºÎ±Î½Î¬ÏÎµÏ„Îµ Î¼Îµ Ï„Î¿ Î¬Î»Î»Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ:</p>
        <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 10px; display: inline-block;">
          ${canvas.outerHTML}
        </div>
        <p><strong>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚:</strong> ${currentBudget}</p>
        <button onclick="showSyncModal()" style="padding: 10px 20px; background: #e91e63; color: white; border: none; border-radius: 8px; cursor: pointer;">
          Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®
        </button>
      </div>
    `;
  });
}

function copySyncCode() {
  if (!currentBudget) return;
  
  navigator.clipboard.writeText(currentBudget).then(() => {
    showQuickMessage('ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!', 'success');
  }).catch(() => {
    const tempInput = document.createElement('input');
    tempInput.value = currentBudget;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    showQuickMessage('ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ Î¿ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!', 'success');
  });
}

function disconnectSync() {
  if (confirm('Î˜Î­Î»ÎµÏ„Îµ Î½Î± Î±Ï€Î¿ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Î±Ï€ÏŒ Ï„Î¿Î½ ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ;\nÎ¤Î± Ï„Î¿Ï€Î¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î¸Î± Ï€Î±ÏÎ±Î¼ÎµÎ¯Î½Î¿Ï…Î½.')) {
    if (firebaseRef) {
      firebaseRef.off();
      firebaseRef = null;
    }
    
    currentBudget = null;
    syncData = {};
    localStorage.setItem('budgetbuddy_sync', JSON.stringify({}));
    
    closeSyncModal();
    updateSyncUI('offline');
    showQuickMessage('ğŸ”Œ Î‘Ï€Î¿ÏƒÏ…Î½Î´ÎµÎ¸Î®ÎºÎ±Ï„Îµ Î±Ï€ÏŒ ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ', 'success');
  }
}

function generateSyncCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 6; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

// ==================== DRAG & DROP Î“Î™Î‘ ÎšÎ‘Î¤Î—Î“ÎŸÎ¡Î™Î•Î£ ====================
function setupDragAndDrop() {
  const categoriesList = document.getElementById('categoriesList');
  const categoryTags = document.querySelectorAll('.category-tag');
  
  categoryTags.forEach(tag => {
    tag.setAttribute('draggable', 'true');
    
    tag.addEventListener('dragstart', handleDragStart);
    tag.addEventListener('dragend', handleDragEnd);
  });
  
  categoriesList.addEventListener('dragover', handleDragOver);
  categoriesList.addEventListener('dragenter', handleDragEnter);
  categoriesList.addEventListener('dragleave', handleDragLeave);
  categoriesList.addEventListener('drop', handleDrop);
}

function handleDragStart(e) {
  draggedCategory = this;
  dragStartIndex = parseInt(this.getAttribute('data-index'));
  this.classList.add('dragging');
  
  e.dataTransfer.effectAllowed = 'move';
  e.dataTransfer.setData('text/plain', this.textContent);
  
  setTimeout(() => {
    this.style.display = 'none';
  }, 0);
}

function handleDragEnd(e) {
  this.classList.remove('dragging');
  this.style.display = 'flex';
  
  const categoriesList = document.getElementById('categoriesList');
  categoriesList.classList.remove('drag-over');
  
  draggedCategory = null;
  dragStartIndex = null;
}

function handleDragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
  return false;
}

function handleDragEnter(e) {
  e.preventDefault();
  const categoriesList = document.getElementById('categoriesList');
  categoriesList.classList.add('drag-over');
}

function handleDragLeave(e) {
  const categoriesList = document.getElementById('categoriesList');
  if (!categoriesList.contains(e.relatedTarget)) {
    categoriesList.classList.remove('drag-over');
  }
}

function handleDrop(e) {
  e.preventDefault();
  e.stopPropagation();
  
  const categoriesList = document.getElementById('categoriesList');
  categoriesList.classList.remove('drag-over');
  
  if (!draggedCategory) return;
  
  const dropTarget = e.target.closest('.category-tag');
  
  if (dropTarget && dropTarget !== draggedCategory) {
    const dropIndex = parseInt(dropTarget.getAttribute('data-index'));
    
    const categoryToMove = categories[dragStartIndex];
    categories.splice(dragStartIndex, 1);
    categories.splice(dropIndex, 0, categoryToMove);
    
    const newRecurringAmounts = {};
    categories.forEach(category => {
      if (recurringAmounts[category] !== undefined) {
        newRecurringAmounts[category] = recurringAmounts[category];
      } else {
        newRecurringAmounts[category] = 0;
      }
    });
    recurringAmounts = newRecurringAmounts;
    
    saveAllData();
    debouncedSync();
    updateCategoriesList();
    updateRecurringInputs();
    updateUIFromData();
    
    showQuickMessage('ğŸ”„ Î‘Î»Î»Î¬Ï‡Ï„Î·ÎºÎµ Î· ÏƒÎµÎ¹ÏÎ¬ Ï„Ï‰Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÏÎ½!', 'success');
  }
  
  return false;
}

// ==================== MAIN APP FUNCTIONS ====================
function cleanupData() {
  categories = categories.filter(cat => cat && typeof cat === 'string' && cat.trim() !== '');
  
  const cleanRecurring = {};
  categories.forEach(cat => {
    if (recurringAmounts[cat] !== undefined) {
      const value = parseFloat(recurringAmounts[cat]);
      cleanRecurring[cat] = isNaN(value) ? 0 : value;
    }
  });
  recurringAmounts = cleanRecurring;
}

function saveAllData() {
  localStorage.setItem('cats', JSON.stringify(categories));
  localStorage.setItem('expenses', JSON.stringify(expenses));
  localStorage.setItem('recurringAmounts', JSON.stringify(recurringAmounts));
  localStorage.setItem('bankBalances', JSON.stringify(bankBalances));
  localStorage.setItem('currentMonth', currentMonth);
  localStorage.setItem('budgetbuddy_transfers', JSON.stringify(transfers));
  localStorage.setItem('budgetbuddy_savings', JSON.stringify(savings));
  
  debouncedSync();
}

function updateUIFromData() {
  const categorySelect = document.getElementById('category');
  if (categories.length > 0) {
    categorySelect.innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join('');
  } else {
    categorySelect.innerHTML = '<option value="">Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÏÏ„Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚</option>';
  }
  
  updateRecentExpenses();
  updateBudgetOverview();
  updateFinancialOverview();
}

function deleteExpense(expenseId) {
  if (!confirm('Î˜Î­Î»ÎµÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ± Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î­Î¾Î¿Î´Î¿;')) {
    return;
  }
  
  const expenseIndex = expenses.findIndex(exp => exp.id === expenseId);
  if (expenseIndex !== -1) {
    expenses.splice(expenseIndex, 1);
    
    // Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Î¾Î±Î½Î¬ Ï„Î± ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬ Î­Î¾Î¿Î´Î±
    recalculateAppBalanceSpent();
    
    saveAllData();
    updateRecentExpenses();
    updateBudgetOverview();
    updateFinancialOverview();
    
    showQuickMessage(`ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ Î­Î¾Î¿Î´Î¿`, 'success');
  }
}

function updateRecentExpenses() {
  const recentExpensesDiv = document.getElementById('recentExpenses');
  const monthExpenses = expenses.filter(exp => exp.date.startsWith(currentMonth));
  const recentExpenses = monthExpenses.slice(-10).reverse();
  
  if (recentExpenses.length === 0) {
    recentExpensesDiv.innerHTML = `
      <div class="empty-state">
        ğŸ“­ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¼Î­Î½Î± Î­Î¾Î¿Î´Î± Î³Î¹Î± Ï„Î¿Î½ ${currentMonth} Î±ÎºÏŒÎ¼Î±
      </div>
    `;
    return;
  }
  
  let html = '';
  recentExpenses.forEach(expense => {
    html += `
      <div class="expense-item">
        <div class="expense-info">
          <div class="expense-category">${expense.category}</div>
          <div class="expense-details">${expense.date} | ${expense.note || '-'}</div>
        </div>
        <div style="display: flex; align-items: center;">
          <div class="expense-amount">${expense.amount.toFixed(2)} â‚¬</div>
          <button class="delete-expense-btn" onclick="deleteExpense(${expense.id})" title="Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎµÎ¾ÏŒÎ´Î¿Ï…">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
    `;
  });
  
  recentExpensesDiv.innerHTML = html;
}

function loadBankValues() {
  document.getElementById('alphaBank').value = bankBalances.alphaBank > 0 ? bankBalances.alphaBank : '';
  document.getElementById('nationalBank').value = bankBalances.nationalBank > 0 ? bankBalances.nationalBank : '';
  document.getElementById('cash').value = bankBalances.cash > 0 ? bankBalances.cash : '';
  document.getElementById('expectedIncome').value = bankBalances.expectedIncome > 0 ? bankBalances.expectedIncome : '';
}

function saveBankBalances() {
  bankBalances = {
    alphaBank: parseFloat(document.getElementById('alphaBank').value) || 0,
    nationalBank: parseFloat(document.getElementById('nationalBank').value) || 0,
    cash: parseFloat(document.getElementById('cash').value) || 0,
    expectedIncome: parseFloat(document.getElementById('expectedIncome').value) || 0
  };
  
  saveAllData();
  updateFinancialOverview();
  
  showQuickMessage('ğŸ’° Î¤Î± Ï„ÏÎ±Ï€ÎµÎ¶Î¹ÎºÎ¬ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!', 'success');
}

function updateCategoriesList() {
  const categoriesListDiv = document.getElementById('categoriesList');
  
  if (categories.length === 0) {
    categoriesListDiv.innerHTML = '<div class="empty-state">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚</div>';
    return;
  }
  
  let html = '';
  categories.forEach((category, index) => {
    html += `
      <div class="category-tag" data-index="${index}">
        <span style="margin-right: 5px;">â˜°</span>
        ${category}
        <button onclick="deleteCategory(${index})" title="Î”Î¹Î±Î³ÏÎ±Ï†Î®" style="background: transparent; border: none; color: white; cursor: pointer; padding: 0; margin-left: 5px; font-size: 16px;">Ã—</button>
      </div>
    `;
  });
  
  categoriesListDiv.innerHTML = html;
  
  setTimeout(() => {
    setupDragAndDrop();
  }, 100);
}

function addNewCategory() {
  const newCategoryInput = document.getElementById('newCategoryName');
  const categoryName = newCategoryInput.value.trim();
  
  if (!categoryName) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ ÏŒÎ½Î¿Î¼Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚', 'error');
    return;
  }
  
  if (categories.includes(categoryName)) {
    showQuickMessage('âš ï¸ Î— ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î·!', 'error');
    return;
  }
  
  categories.push(categoryName);
  newCategoryInput.value = '';
  
  saveAllData();
  updateCategoriesList();
  updateRecurringInputs();
  updateUIFromData();
  showQuickMessage(`âœ… Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ Î· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± "${categoryName}"`, 'success');
}

function isDesktop() {
  return window.innerWidth > 768;
}

function deleteCategory(index) {
  const categoryName = categories[index];
  
  if (!confirm(`Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±Ï‚ "${categoryName}";\nÎ˜Î± Î´Î¹Î±Î³ÏÎ±Ï†Î¿ÏÎ½ ÎºÎ±Î¹ ÏŒÎ»Î± Ï„Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î­Î¾Î¿Î´Î±!\nÎ£Î¯Î³Î¿Ï…ÏÎ±;`)) {
    return;
  }
  
  categories.splice(index, 1);
  
  // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Ï€Î¿ÏƒÏÎ½ Î±Ï€ÏŒ Ï„Î± Î­Î¾Î¿Î´Î±
  expenses = expenses.filter(e => e.category !== categoryName);
  
  // Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Î¾Î±Î½Î¬ Ï„Î± ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬ Î­Î¾Î¿Î´Î±
  recalculateAppBalanceSpent();
  
  if (recurringAmounts[categoryName]) {
    delete recurringAmounts[categoryName];
  }
  
  saveAllData();
  updateCategoriesList();
  updateRecurringInputs();
  updateUIFromData();
  showQuickMessage(`ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ Î· ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± "${categoryName}"`, 'success');
}

function updateRecurringInputs() {
  const recurringInputsDiv = document.getElementById('recurringInputs');
  
  if (categories.length === 0) {
    recurringInputsDiv.innerHTML = '<p style="color:#777;">Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÏÏ„Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚</p>';
    return;
  }
  
  let html = '<div style="display: grid; gap: 10px;">';
  
  categories.forEach((category, index) => {
    const amount = recurringAmounts[category] || 0;
    const uniqueId = `recurring_${index}_${category.replace(/\s+/g, '_')}`;
    
    html += `
      <div style="display: flex; align-items: center; gap: 10px; background: white; padding: 10px; border-radius: 8px;">
        <div style="flex: 1; font-weight: 500;">${category}</div>
        <input type="number" 
               id="${uniqueId}" 
               value="${amount > 0 ? amount : ''}" 
               step="0.01" 
               placeholder="0.00"
               style="width: 100px; padding: 8px; text-align: right;"
               onchange="updateSingleRecurringAmount('${category}', this.value)">
        <span style="color: #666;">â‚¬</span>
      </div>
    `;
  });
  
  html += '</div>';
  recurringInputsDiv.innerHTML = html;
}

function updateSingleRecurringAmount(category, value) {
  const numValue = parseFloat(value) || 0;
  recurringAmounts[category] = numValue;
  saveAllData();
  updateFinancialOverview();
}

function saveRecurringAmounts() {
  if (categories.length === 0) {
    showQuickMessage('âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚', 'error');
    return;
  }
  
  categories.forEach(category => {
    const inputs = document.querySelectorAll(`input[id^="recurring_"]`);
    
    inputs.forEach(input => {
      if (input.id.includes(category.replace(/\s+/g, '_')) || 
          input.previousElementSibling?.textContent?.includes(category)) {
        const value = parseFloat(input.value) || 0;
        recurringAmounts[category] = value;
      }
    });
  });
  
  saveAllData();
  updateFinancialOverview();
  
  showQuickMessage('ğŸ’¾ ÎŸÎ¹ Î¼Î·Î½Î¹Î±Î¯Î¿Î¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!', 'success');
}

function addExpense() {
  if (categories.length === 0) {
    showQuickMessage('âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€ÏÏÏ„Î± ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚', 'error');
    return;
  }
  
  const amount = parseFloat(document.getElementById('amount').value);
  const category = document.getElementById('category').value;
  const date = document.getElementById('date').value;
  const note = document.getElementById('note').value.trim();
  
  if (!amount || amount <= 0) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î­Î½Î± Î­Î³ÎºÏ…ÏÎ¿ Ï€Î¿ÏƒÏŒ', 'error');
    document.getElementById('amount').focus();
    return;
  }
  
  if (!date) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±', 'error');
    document.getElementById('date').focus();
    return;
  }
  
  if (!category) {
    showQuickMessage('âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î±', 'error');
    document.getElementById('category').focus();
    return;
  }
  
  const newExpense = {
    id: Date.now() + Math.random(),
    amount: amount,
    category: category,
    date: date,
    note: note || '-',
    isRecurring: false
  };
  
  expenses.push(newExpense);
  
  // ğŸ”´ ÎšÎ¡Î™Î¤Î™ÎšÎ— Î”Î™ÎŸÎ¡Î˜Î©Î£Î—: Î‘Î½Ï„Î¯ Î³Î¹Î± appBalanceData.spent += amount;
  // Ï…Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Î¾Î±Î½Î¬ Ï„Î± ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬ Î­Î¾Î¿Î´Î±
  recalculateAppBalanceSpent();
  
  document.getElementById('amount').value = '';
  document.getElementById('note').value = '';
  
  saveAllData();
  
  const addButton = document.getElementById('addExpenseButton');
  const originalHTML = addButton.innerHTML;
  const originalBackground = addButton.style.background;
  
  addButton.innerHTML = '<span>âœ…</span>';
  addButton.style.background = '#4caf50';
  
  setTimeout(() => {
    addButton.innerHTML = originalHTML;
    addButton.style.background = originalBackground;
  }, 1500);
  
  showQuickMessage(`âœ… Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ Î­Î¾Î¿Î´Î¿ ${category} - ${amount.toFixed(2)}â‚¬`, 'success');
  
  updateRecentExpenses();
  updateBudgetOverview();
  updateFinancialOverview();
  
  document.getElementById('amount').focus();
}

function updateBudgetOverview() {
  const budgetCardsDiv = document.getElementById('budgetCards');
  const monthExpenses = expenses.filter(e => e.date.startsWith(currentMonth));
  
  // ÎšÎ‘Î¡Î¤Î‘ Î‘Î ÎŸÎ¤Î‘ÎœÎ™Î•Î¥Î£Î—Î£ Î Î¡Î©Î¤Î—
  let html = `
    <div class="budget-card savings" style="grid-column: 1 / -1;">
      <h3 style="margin-top: 0; color: #333;">ğŸ’° Î“ÎµÎ½Î¹ÎºÎ® Î‘Ï€Î¿Ï„Î±Î¼Î¯ÎµÏ…ÏƒÎ·</h3>
      <div style="text-align: center; margin: 20px 0;">
        <div style="font-size: 32px; font-weight: bold; color: #ff9800;">${savings.general.toFixed(2)} â‚¬</div>
        <div style="font-size: 12px; color: #666;">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÎ­Ï‚</div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px;">
        <div style="text-align: center; padding: 10px; background: #fff8e1; border-radius: 5px;">
          <div>ğŸ“ˆ Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ</div>
          <div style="font-weight: bold; color: #4caf50;">${savings.totalAdded.toFixed(2)}â‚¬</div>
        </div>
        <div style="text-align: center; padding: 10px; background: #ffebee; border-radius: 5px;">
          <div>ğŸ“‰ Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ</div>
          <div style="font-weight: bold; color: #f44336;">${savings.totalUsed.toFixed(2)}â‚¬</div>
        </div>
      </div>
    </div>
  `;
  
  if (categories.length === 0) {
    html += `
      <div class="empty-state" style="grid-column: 1/-1;">
        ğŸ“‚ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚!
      </div>
    `;
    budgetCardsDiv.innerHTML = html;
    return;
  }
  
  // ÎšÎ‘Î¤Î—Î“ÎŸÎ¡Î™Î•Î£
  categories.forEach(category => {
    const categoryExpenses = monthExpenses.filter(e => e.category === category);
    const categorySpent = categoryExpenses.reduce((sum, e) => sum + e.amount, 0);
    const categoryBudget = recurringAmounts[category] || 0;
    
    // Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î©Î
    const transfersToCategory = transfers.filter(t => 
      t.month === currentMonth && t.to === category
    );
    const transfersFromCategory = transfers.filter(t => 
      t.month === currentMonth && t.from === category
    );
    
    const totalTransferredIn = transfersToCategory.reduce((sum, t) => sum + t.amount, 0);
    const totalTransferredOut = transfersFromCategory.reduce((sum, t) => sum + t.amount, 0);
    
    // Î•Î¦Î‘Î¡ÎœÎŸÎ“Î— ÎœÎ•Î¤Î‘Î¦ÎŸÎ¡Î©Î Î£Î¤ÎŸÎ Î Î¡ÎŸÎ¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸ
    const adjustedBudget = categoryBudget + totalTransferredIn - totalTransferredOut;
    const remaining = adjustedBudget - categorySpent;
    const percentage = adjustedBudget > 0 ? Math.min(100, (categorySpent / adjustedBudget) * 100) : 0;
    
    let statusClass = '';
    if (remaining < 0) {
      statusClass = 'over';
    } else if (remaining > 0) {
      statusClass = 'under';
    }
    
    // ÎšÎ‘Î¡Î¤Î‘ ÎšÎ‘Î¤Î—Î“ÎŸÎ¡Î™Î‘Î£
    html += `
      <div class="budget-card ${statusClass}">
        <h3 style="margin-top: 0; color: #333;">${category}</h3>
        
        ${(totalTransferredIn > 0 || totalTransferredOut > 0) ? `
          <div style="font-size: 11px; color: #666; margin-bottom: 5px;">
            ${totalTransferredIn > 0 ? `ğŸ“¥ +${totalTransferredIn.toFixed(2)}â‚¬` : ''}
            ${totalTransferredOut > 0 ? `ğŸ“¤ -${totalTransferredOut.toFixed(2)}â‚¬` : ''}
          </div>
        ` : ''}
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
          <div>
            <div style="font-size: 12px; color: #666;">Î ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚</div>
            <div style="font-weight: bold; color: #333;">${adjustedBudget.toFixed(2)} â‚¬</div>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 12px; color: #666;">ÎÎ¿Î´ÎµÏÏ„Î·ÎºÎ±Î½</div>
            <div style="font-weight: bold; color: #e91e63;">${categorySpent.toFixed(2)} â‚¬</div>
          </div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${percentage}%;"></div>
        </div>
        
        <div style="text-align: center; margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
          <div style="font-size: 12px; color: #666;">ÎœÎ­Î½Î¿Ï…Î½</div>
          <div style="font-size: 20px; font-weight: bold; color: ${remaining >= 0 ? '#4caf50' : '#f44336'}">
            ${remaining.toFixed(2)} â‚¬
          </div>
          <div style="font-size: 11px; color: #999;">(${percentage.toFixed(1)}%)</div>
        </div>
      </div>
    `;
  });
  
  budgetCardsDiv.innerHTML = html;
}

// ==================== INITIALIZATION ====================
window.onload = function() {
  const starsContainer = document.getElementById('stars');
  const starColors = ['#fff', '#ffd1e8', '#ffb6c1', '#ffc0cb'];
  
  for (let i = 0; i < 40; i++) {
    const star = document.createElement('div');
    star.classList.add('star');
    star.textContent = 'â˜…';
    star.style.left = Math.random() * 100 + '%';
    star.style.top = Math.random() * 100 + 'px';
    star.style.animationDelay = (Math.random() * 5) + 's';
    star.style.color = starColors[Math.floor(Math.random() * starColors.length)];
    starsContainer.appendChild(star);
  }
  
  const today = new Date().toISOString().slice(0,10);
  document.getElementById('date').value = today;
  
  cleanupData();
  updateUIFromData();
  updateCategoriesList();
  updateRecurringInputs();
  loadBankValues();
  
  initMonthSelector();
  updateFinancialOverview();
  
  // ÎšÎ¡Î™Î¤Î™ÎšÎ— Î”Î™ÎŸÎ¡Î˜Î©Î£Î—: Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ ÏƒÏ‰ÏƒÏ„Î¬ Ï„Î± Î­Î¾Î¿Î´Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Ï†ÏŒÏÏ„Ï‰ÏƒÎ·
  recalculateAppBalanceSpent();
  
  initSync();
  
  // ÎÎ•ÎŸ: Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ Î¼ÎµÏ„Î±Ï†Î¿ÏÏÎ½
  loadTransferUI();
  
  document.getElementById('amount').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      addExpense();
    }
  });
  
  document.getElementById('note').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      addExpense();
    }
  });
  
  document.getElementById('category').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      document.getElementById('note').focus();
    }
  });
  
  document.getElementById('date').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      document.getElementById('note').focus();
    }
  });
  
  document.getElementById('newCategoryName').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      if (isDesktop()) {
        addNewCategory();
        setTimeout(() => {
          document.getElementById('newCategoryName').focus();
        }, 100);
      }
    }
  });
  
  document.getElementById('initialAppBalanceInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      setInitialAppBalance();
    }
  });
  
  const bankInputs = ['alphaBank', 'nationalBank', 'cash', 'expectedIncome'];
  bankInputs.forEach(id => {
    const input = document.getElementById(id);
    if (input) {
      input.addEventListener('input', function() {
        setTimeout(updateFinancialOverview, 500);
      });
    }
  });
  
  setInterval(() => {
    if (currentBudget && !isSyncing) {
      syncToFirebase();
    }
  }, 60000);
  
  document.getElementById('amount').focus();
  
  const tab4Button = document.querySelector('.tab:nth-child(4)');
  tab4Button.addEventListener('click', function() {
    setTimeout(() => {
      const newCategoryInput = document.getElementById('newCategoryName');
      if (newCategoryInput && isDesktop()) {
        newCategoryInput.focus();
      }
    }, 300);
  });
};
</script>
</body>
</html>
